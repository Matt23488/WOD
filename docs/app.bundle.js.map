{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/ts/Application.ts","src/ts/Character/Character.ts","src/ts/Character/Damage.ts","src/ts/Character/Equipment.ts","src/ts/Character/InventoryItem.ts","src/ts/Character/Merit.ts","src/ts/Character/Note.ts","src/ts/Command/AttributeCommand.ts","src/ts/Command/BatchCommand.ts","src/ts/Command/ClearUsedCommand.ts","src/ts/Command/CollectionAddCommand.ts","src/ts/Command/CollectionMoveCommand.ts","src/ts/Command/CollectionRemoveCommand.ts","src/ts/Command/CommandStack.ts","src/ts/Command/TextInputCommand.ts","src/ts/Dice.ts","src/ts/main.ts","src/ts/utils.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Character_1","Dice_1","CommandStack_1","Application","prototype","toggleClock","this","showClock","goBack","mode","_previousSection","window","location","hash","newCharacter","newChar","default","locked","characters","push","selectCharacter","character","charIndex","indexOf","characterId","instance","reset","deleteCharacter","confirm","name","id","remove","saveCharacters","localStorage","setItem","JSON","stringify","realCharacters","map","toJson","alert","downloadCharacter","json","dl","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild","uploadCharacter","_this","ul","type","accept","addEventListener","file","files","reader","FileReader","onload","target","result","fromJson","parse","readAsText","toggleCharacterLock","switchMode","getElementById","undo","canUndo","redo","canRedo","registerKeyboardCommand","key","callback","_keyboardCommands","set","enableKeyboardCommands","ctrlKey","_b","__values","entries","_c","next","done","_d","__read","value","preventDefault","savedCharacters","getItem","unshift","ghost","ko","observable","observableArray","computed","filter","dice","lockButtonClass","lockButtonIcon","currentTime","Date","currentTimeDisplay","time","hours","getHours","minutes","getMinutes","seconds","getSeconds","suffix","setInterval","Map","log","substring","$domElement","$","scrollTop","offset","top","Damage_1","Equipment_1","InventoryItem_1","Merit_1","Note_1","utils_1","CollectionAddCommand_1","CollectionRemoveCommand_1","CollectionMoveCommand_1","ClearUsedCommand_1","AttributeCommand_1","Character","firstNameLength","randomInteger","lastNameLength","firstName","lastName","newLetter","alphabet","charAt","toUpperCase","randomName","player","age","vice","virtue","origins","gender","concept","chronicle","intelligence","strength","presence","wits","dexterity","manipulation","resolve","stamina","composure","academics","robotics","crafts","investigation","medicine","occult","politics","science","athletics","brawl","drive","ranged","larceny","stealth","survival","weaponry","animalKen","empathy","expression","intimidation","persuasion","socialize","streetwise","subterfuge","merits","spells","flaws","size","armor","experience","morality","weapons","equipment","inventory","notes","onComponentClick","_","currentTarget","getElementsByTagName","focus","newItem","constructor","execute","createLockable","removeItem","item","moveItem","direction","index","newIndex","clearUsed","usedObservable","bashing","damage","lethal","aggravated","usedMagic","usedWillpower","m","s","w","description","quantity","__decorate","label","extend","lockable","setName","numeric","precision","min","max","speed","defense","Math","initiative","health","magic","subscribe","val","executeWithPrevious","willpower","BatchCommand_1","Damage","anyEmpty","totalHealth","addBashing","addLethal","addAggravated","clearAll","totalHealthObservable","Equipment","InventoryItem","getDisplayText","displayText","Merit","Note","AttributeCommand","getType","toString","_observable","getName","_oldValue","_newValue","doesNothing","newValue","oldValue","BatchCommand","Object","defineProperty","_commands","getCommand","every","command","commands","_i","arguments","ClearUsedCommand","CollectionAddCommand","_newItem","CollectionMoveCommand","splice","_oldIndex","_newIndex","_item","oldIndex","CollectionRemoveCommand","_itemIndex","CommandStack","_instance","_undoStack","_redoStack","getPreviousCommand","drillIntoBatch","previousCommand","undoLength","commandCount","removeAll","_currentlyExecuting","setTimeout","pop","console","redoLength","TextInputCommand","Dice","incrementDicePool","amount","newAmount","dicePool","rollDice","RollState","beginRoll","rollRounds","rollingInProgress","totalDiceSuccesses","reduce","total","d","totalDiceSuccessesDisplay","_diceObj","_currentRoundRolls","_currentRoundResults","_intervalHandle","nextRoll","_nextRoundRolls","diceContainer_1","getElementsByClassName","critMessage_1","classList","add","innerText","_currentDice","replace","_currentRound","clearInterval","critMessage","diceObj","Application_1","applyCustomKnockoutCode","constructors","app","toggleTooltips","enable","tooltip","applyBindings","outerWidth","TextInputCommand_1","randomFloat","minInclusive","maxExclusive","_a","random","floor","_observableNameMap","bindingHandlers","update","element","valueAccessor","divs","newRound","rolls","span","delay","animation","spans","j","roll","backgroundImage","innerHTML","damageDisplay","init","damageObj","attribute","dots","dot","dataset","toggle","title","forEach","canClear","clearDot","backgroundColor","borderColor","readOnlyAttribute","hideUnfilled","used","focusOnCreation","contextMenu","undoableTextInput","inputElement","extenders","named","pureComputed","read","write","notifySubscribers","notify","args","Infinity","current","roundingMultiplier","pow","newValueAsNum","isNaN","valueToWrite","round","subscribable","fn","get"],"mappings":"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","file":"app.bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import Character from \"./Character/Character\";\r\nimport Dice from \"./Dice\";\r\nimport swal from \"sweetalert\";\r\nimport CommandStack from \"./Command/CommandStack\";\r\n\r\nexport default class Application {\r\n    public mode: KnockoutObservable<string>;\r\n    public characterId: KnockoutObservable<number>;\r\n    public characters: KnockoutObservableArray<Character>;\r\n    public realCharacters: KnockoutComputed<Array<Character>>;\r\n    public character: KnockoutComputed<Character>;\r\n    public dice: Dice;\r\n    public lockButtonClass: KnockoutComputed<string>;\r\n    public lockButtonIcon: KnockoutComputed<string>;\r\n    private _previousSection: string;\r\n    public showClock: KnockoutObservable<boolean>;\r\n    public currentTime: KnockoutObservable<Date>;\r\n    public currentTimeDisplay: KnockoutComputed<string>;\r\n    public canUndo: KnockoutComputed<boolean>;\r\n    public canRedo: KnockoutComputed<boolean>;\r\n    private _keyboardCommands: Map<string, () => void>;\r\n\r\n    public constructor() {\r\n        const savedCharacters: Array<Character> = (JSON.parse(window.localStorage.getItem(\"characters\")) || []).map(Character.fromJson);\r\n        savedCharacters.unshift(Character.newCharacter());\r\n        savedCharacters[0].ghost = true;\r\n\r\n        this.mode = ko.observable(\"list\");\r\n        this.characterId = ko.observable(0);\r\n        this.characters = ko.observableArray(savedCharacters);\r\n        this.realCharacters = ko.computed(() => this.characters().filter(c => !c.ghost), this);\r\n        this.character = ko.computed(() => this.characters()[this.characterId()], this);\r\n        this.dice = new Dice();\r\n        this.lockButtonClass = ko.computed(() => this.character().locked() ? \"btn-danger\" : \"btn-outline-success\", this);\r\n        this.lockButtonIcon = ko.computed(() => this.character().locked() ? \"fas fa-lock\" : \"fas fa-lock-open\", this);\r\n        this._previousSection = null;\r\n        this.showClock = ko.observable(false);\r\n        this.currentTime = ko.observable(new Date());\r\n\r\n        this.currentTimeDisplay = ko.computed(() => {\r\n            const time = this.currentTime();\r\n            let hours = time.getHours();\r\n            const minutes = time.getMinutes();\r\n            const seconds = time.getSeconds();\r\n            const suffix = hours < 12 ? \"AM\" : \"PM\";\r\n            const minutePrefix = minutes < 10 ? \"0\" : \"\";\r\n            const secondPrefix = seconds < 10 ? \"0\" : \"\";\r\n            if (hours > 12) hours -= 12;\r\n            else if (hours === 0) hours = 12;\r\n            return `${hours}:${minutePrefix}${minutes}:${secondPrefix}${seconds} ${suffix}`;\r\n        }, this);\r\n\r\n        this.canUndo = ko.computed(() => CommandStack.instance.canUndo() && !this.character().locked(), this);\r\n        this.canRedo = ko.computed(() => CommandStack.instance.canRedo() && !this.character().locked(), this);\r\n\r\n        window.setInterval(() => {\r\n            this.currentTime(new Date());\r\n        }, 1000);\r\n\r\n        this._keyboardCommands = new Map<string, () => void>();\r\n        this.registerKeyboardCommand(\"s\", () => this.saveCharacters());\r\n        this.registerKeyboardCommand(\"z\", () => { \r\n            if (this.mode() === \"list\") return;\r\n            this.undo();\r\n        });\r\n        this.registerKeyboardCommand(\"Z\", () => {\r\n            if (this.mode() === \"list\") return;\r\n            this.redo();\r\n        });\r\n        this.registerKeyboardCommand(\"l\", () => {\r\n            if (this.mode() === \"list\") return;\r\n            this.toggleCharacterLock();\r\n        });\r\n        this.registerKeyboardCommand(\"o\", () => this.toggleClock());\r\n        this.registerKeyboardCommand(\"q\", () => CommandStack.instance.log());\r\n        this.enableKeyboardCommands();\r\n\r\n        window.addEventListener(\"hashchange\", e => {\r\n            const hash = window.location.hash.substring(1);\r\n            if (!hash) return;\r\n\r\n            var offset = 80; // TODO: Don't hardcode this maybe?\r\n            var $domElement = $(`#${hash}`);\r\n            $(window).scrollTop($domElement.offset().top - offset);\r\n        });\r\n    }\r\n\r\n    public toggleClock(): void {\r\n        this.showClock(!this.showClock());\r\n    }\r\n\r\n    public goBack(): void {\r\n        if (this.mode() === \"sheet\") this.mode(\"list\");\r\n        else {\r\n            this.mode(\"sheet\");\r\n\r\n            if (this._previousSection) window.location.hash = this._previousSection;\r\n        }\r\n    }\r\n\r\n    public newCharacter(): void {\r\n        const newChar = Character.newCharacter();\r\n        newChar.locked(false);\r\n        this.characters.push(newChar);\r\n        this.selectCharacter(newChar);\r\n    }\r\n\r\n    public selectCharacter(character: Character): void {\r\n        const charIndex = this.characters.indexOf(character);\r\n        if (this.characterId() !== charIndex) {\r\n            this.characterId(charIndex);\r\n            CommandStack.instance.reset();\r\n        }\r\n        this.mode(\"sheet\");\r\n    }\r\n\r\n    public deleteCharacter(character: Character): void {\r\n        // swal({\r\n        //     title: `Delete ${this.character().name()}`,\r\n        //     text: \"Are you sure? (As long as you don't save, your character won't be gone.)\",\r\n        //     icon: \"warning\",\r\n        //     buttons: [\"Cancel\", \"Delete\"],\r\n        //     dangerMode: true\r\n        // })\r\n        // .then((willDelete: boolean) => {\r\n        //     if (willDelete) {\r\n        //         const id = this.characterId();\r\n        //         this.characterId(0);\r\n        //         this.characters.remove(this.characters()[id]);\r\n        //         this.mode(\"list\");\r\n        //     }\r\n        // });\r\n        if (this.character().locked()) return;\r\n        if (confirm(`Are you sure you want to delete ${this.character().name()}? (As long as you don't save, your character won't be gone.)`)) {\r\n            const id = this.characterId();\r\n            this.characterId(0);\r\n            this.characters.remove(this.characters()[id]);\r\n            this.mode(\"list\");\r\n        }\r\n    }\r\n\r\n    public saveCharacters(): void {\r\n        window.localStorage.setItem(\"characters\", JSON.stringify(this.realCharacters().map(c => c.toJson())));\r\n        // swal(\"Characters saved successfully!\", {\r\n        //     buttons: [],\r\n        //     timer: 1000,\r\n        //     icon: \"success\"\r\n        // });\r\n        alert(\"Characters saved successfully!\");\r\n    }\r\n\r\n    public downloadCharacter(): void {\r\n        const json = JSON.stringify(this.character().toJson());\r\n\r\n        const dl = document.createElement(\"a\");\r\n        dl.setAttribute(\"href\", `data:text/plain;charset=utf-8,${encodeURIComponent(json)}`);\r\n        dl.setAttribute(\"download\", `${this.character().name()}.json`);\r\n\r\n        dl.style.display = \"none\";\r\n        document.body.appendChild(dl);\r\n\r\n        dl.click();\r\n\r\n        document.body.removeChild(dl);\r\n    }\r\n\r\n    public uploadCharacter(): void {\r\n        const ul = document.createElement(\"input\");\r\n        ul.type = \"file\";\r\n        ul.accept = \".json\";\r\n        ul.style.display = \"none\";\r\n\r\n        ul.addEventListener(\"change\", e => {\r\n            const file = ul.files[0];\r\n            if (!file) return;\r\n\r\n            const reader = new FileReader();\r\n            reader.onload = (e: any) => {\r\n                const json = e.target.result;\r\n                this.characters.push(Character.fromJson(JSON.parse(json)));\r\n                this.characterId(this.characters().length - 1);\r\n                this.mode(\"sheet\");\r\n            };\r\n            reader.readAsText(file);\r\n        });\r\n\r\n        document.body.appendChild(ul);\r\n\r\n        ul.click();\r\n\r\n        document.body.removeChild(ul);\r\n    }\r\n\r\n    public toggleCharacterLock(): void {\r\n        const character = this.character();\r\n        character.locked(!character.locked());\r\n    }\r\n\r\n    public switchMode(mode: string): () => void {\r\n        return () => {\r\n            if (this.mode() !== \"list\" && document.getElementById(mode)) {\r\n                this._previousSection = mode;\r\n            }\r\n            else this._previousSection = null;\r\n\r\n            window.location.hash = \"\";\r\n            this.mode(mode);\r\n        }\r\n    }\r\n\r\n    public undo(): void {\r\n        if (!this.canUndo()) return;\r\n        CommandStack.instance.undo();\r\n    }\r\n\r\n    public redo(): void {\r\n        if (!this.canRedo()) return;\r\n        CommandStack.instance.redo();\r\n    }\r\n\r\n    private registerKeyboardCommand(key: string, callback: () => void): void {\r\n        this._keyboardCommands.set(key, callback);\r\n    }\r\n\r\n    private enableKeyboardCommands(): void {\r\n        window.addEventListener(\"keydown\", e => {\r\n            if (e.ctrlKey !== true) return;\r\n\r\n            for (let [key, callback] of this._keyboardCommands.entries()) {\r\n                if (e.key === key) {\r\n                    e.preventDefault();\r\n                    callback();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n}","import Damage from \"./Damage\";\r\nimport Equipment from \"./Equipment\";\r\nimport InventoryItem from \"./InventoryItem\";\r\nimport Merit from \"./Merit\";\r\nimport Note from \"./Note\";\r\nimport { randomInteger, label } from \"../utils\";\r\nimport CommandStack from \"../Command/CommandStack\";\r\nimport CollectionAddCommand from \"../Command/CollectionAddCommand\";\r\nimport CollectionRemoveCommand from \"../Command/CollectionRemoveCommand\";\r\nimport CollectionMoveCommand from \"../Command/CollectionMoveCommand\";\r\nimport ClearUsedCommand from \"../Command/ClearUsedCommand\";\r\nimport AttributeCommand from \"../Command/AttributeCommand\";\r\n\r\nexport default class Character {\r\n    public ghost: boolean = false;\r\n    public locked: KnockoutObservable<boolean> = ko.observable(true);\r\n\r\n    @label(\"Name\")\r\n    public name: KnockoutObservable<string>;\r\n    public player: KnockoutObservable<string>;\r\n    public age: KnockoutObservable<number>;\r\n    public vice: KnockoutObservable<string>;\r\n    public virtue: KnockoutObservable<string>;\r\n    public origins: KnockoutObservable<string>;\r\n    public gender: KnockoutObservable<string>;\r\n    public concept: KnockoutObservable<string>;\r\n    public chronicle: KnockoutObservable<string>;\r\n\r\n    public intelligence: KnockoutObservable<number>;\r\n    public strength: KnockoutObservable<number>;\r\n    public presence: KnockoutObservable<number>;\r\n    public wits: KnockoutObservable<number>;\r\n    public dexterity: KnockoutObservable<number>;\r\n    public manipulation: KnockoutObservable<number>;\r\n    public resolve: KnockoutObservable<number>;\r\n    public stamina: KnockoutObservable<number>;\r\n    public composure: KnockoutObservable<number>;\r\n\r\n    public academics: KnockoutObservable<number>;\r\n    public robotics: KnockoutObservable<number>;\r\n    public crafts: KnockoutObservable<number>;\r\n    public investigation: KnockoutObservable<number>;\r\n    public medicine: KnockoutObservable<number>;\r\n    public occult: KnockoutObservable<number>;\r\n    public politics: KnockoutObservable<number>;\r\n    public science: KnockoutObservable<number>;\r\n    \r\n    public athletics: KnockoutObservable<number>;\r\n    public brawl: KnockoutObservable<number>;\r\n    public drive: KnockoutObservable<number>;\r\n    public ranged: KnockoutObservable<number>;\r\n    public larceny: KnockoutObservable<number>;\r\n    public stealth: KnockoutObservable<number>;\r\n    public survival: KnockoutObservable<number>;\r\n    public weaponry: KnockoutObservable<number>;\r\n\r\n    public animalKen: KnockoutObservable<number>;\r\n    public empathy: KnockoutObservable<number>;\r\n    public expression: KnockoutObservable<number>;\r\n    public intimidation: KnockoutObservable<number>;\r\n    public persuasion: KnockoutObservable<number>;\r\n    public socialize: KnockoutObservable<number>;\r\n    public streetwise: KnockoutObservable<number>;\r\n    public subterfuge: KnockoutObservable<number>;\r\n\r\n    public merits: KnockoutObservableArray<Merit>;\r\n    public spells: KnockoutObservableArray<Merit>;\r\n    public flaws: KnockoutObservableArray<Merit>;\r\n\r\n    public size: KnockoutObservable<number>;\r\n    public speed: KnockoutComputed<number>;\r\n    public defense: KnockoutComputed<number>;\r\n    public armor: KnockoutObservable<number>;\r\n    public initiative: KnockoutComputed<number>;\r\n    public experience: KnockoutObservable<number>;\r\n    public morality: KnockoutObservable<number>;\r\n\r\n    public weapons: KnockoutObservableArray<Equipment>;\r\n    public equipment: KnockoutObservableArray<Equipment>;\r\n    public inventory: KnockoutObservableArray<InventoryItem>;\r\n\r\n    public notes: KnockoutObservableArray<Note>;\r\n\r\n    public health: KnockoutComputed<number>;\r\n    public damage: Damage;\r\n\r\n    public magic: KnockoutComputed<number>;\r\n    public usedMagic: KnockoutObservable<number>;\r\n\r\n    public willpower: KnockoutComputed<number>;\r\n    public usedWillpower: KnockoutObservable<number>;\r\n\r\n    public constructor(json: CharacterJson) {\r\n        this.name = ko.observable(json.name).extend({ lockable: this.locked });\r\n        // this.name.setName(\"Name\");\r\n        this.player = ko.observable(json.player).extend({ lockable: this.locked });\r\n        this.player.setName(\"Player\");\r\n        this.age = ko.observable(json.age).extend({ numeric: { precision: 0 }, lockable: this.locked });\r\n        this.age.setName(\"Age\");\r\n        this.vice = ko.observable(json.vice).extend({ lockable: this.locked });\r\n        this.vice.setName(\"Vice\");\r\n        this.virtue = ko.observable(json.virtue).extend({ lockable: this.locked });\r\n        this.virtue.setName(\"Virtue\");\r\n        this.origins = ko.observable(json.origins).extend({ lockable: this.locked });\r\n        this.origins.setName(\"Origins\");\r\n        this.gender = ko.observable(json.gender).extend({ lockable: this.locked });\r\n        this.gender.setName(\"Gender\");\r\n        this.concept = ko.observable(json.concept).extend({ lockable: this.locked });\r\n        this.concept.setName(\"Concept\");\r\n        this.chronicle = ko.observable(json.chronicle).extend({ lockable: this.locked });\r\n        this.chronicle.setName(\"Chronicle\");\r\n\r\n        this.intelligence = ko.observable(json.intelligence).extend({ lockable: this.locked });\r\n        this.intelligence.setName(\"Intelligence\");\r\n        this.strength = ko.observable(json.strength).extend({ lockable: this.locked });\r\n        this.strength.setName(\"Strength\");\r\n        this.presence = ko.observable(json.presence).extend({ lockable: this.locked });\r\n        this.presence.setName(\"Presence\");\r\n        this.wits = ko.observable(json.wits).extend({ lockable: this.locked });\r\n        this.wits.setName(\"Wits\");\r\n        this.dexterity = ko.observable(json.dexterity).extend({ lockable: this.locked });\r\n        this.dexterity.setName(\"Dexterity\");\r\n        this.manipulation = ko.observable(json.manipulation).extend({ lockable: this.locked });\r\n        this.manipulation.setName(\"Manipulation\");\r\n        this.resolve = ko.observable(json.resolve).extend({ lockable: this.locked });\r\n        this.resolve.setName(\"Resolve\");\r\n        this.stamina = ko.observable(json.stamina).extend({ lockable: this.locked });\r\n        this.stamina.setName(\"Stamina\");\r\n        this.composure = ko.observable(json.composure).extend({ lockable: this.locked });\r\n        this.composure.setName(\"Composure\");\r\n\r\n        this.academics = ko.observable(json.academics).extend({ lockable: this.locked });\r\n        this.academics.setName(\"Academics\");\r\n        this.robotics = ko.observable(json.robotics).extend({ lockable: this.locked });\r\n        this.robotics.setName(\"Robotics\");\r\n        this.crafts = ko.observable(json.crafts).extend({ lockable: this.locked });\r\n        this.crafts.setName(\"Crafts\");\r\n        this.investigation = ko.observable(json.investigation).extend({ lockable: this.locked });\r\n        this.investigation.setName(\"Investigation\");\r\n        this.medicine = ko.observable(json.medicine).extend({ lockable: this.locked });\r\n        this.medicine.setName(\"Medicine\");\r\n        this.occult = ko.observable(json.occult).extend({ lockable: this.locked });\r\n        this.occult.setName(\"Occult\");\r\n        this.politics = ko.observable(json.politics).extend({ lockable: this.locked });\r\n        this.politics.setName(\"Politics\");\r\n        this.science = ko.observable(json.science).extend({ lockable: this.locked });\r\n        this.science.setName(\"Science\");\r\n\r\n        this.athletics = ko.observable(json.athletics).extend({ lockable: this.locked });\r\n        this.athletics.setName(\"Athletics\");\r\n        this.brawl = ko.observable(json.brawl).extend({ lockable: this.locked });\r\n        this.brawl.setName(\"Brawl\");\r\n        this.drive = ko.observable(json.drive).extend({ lockable: this.locked });\r\n        this.drive.setName(\"Drive\");\r\n        this.ranged = ko.observable(json.ranged).extend({ lockable: this.locked });\r\n        this.ranged.setName(\"Ranged\");\r\n        this.larceny = ko.observable(json.larceny).extend({ lockable: this.locked });\r\n        this.larceny.setName(\"Larceny\");\r\n        this.stealth = ko.observable(json.stealth).extend({ lockable: this.locked });\r\n        this.stealth.setName(\"Stealth\");\r\n        this.survival = ko.observable(json.survival).extend({ lockable: this.locked });\r\n        this.survival.setName(\"Survival\");\r\n        this.weaponry = ko.observable(json.weaponry).extend({ lockable: this.locked });\r\n        this.weaponry.setName(\"Weaponry\");\r\n\r\n        this.animalKen = ko.observable(json.animalKen).extend({ lockable: this.locked });\r\n        this.animalKen.setName(\"AnimalKen\");\r\n        this.empathy = ko.observable(json.empathy).extend({ lockable: this.locked });\r\n        this.empathy.setName(\"Empathy\");\r\n        this.expression = ko.observable(json.expression).extend({ lockable: this.locked });\r\n        this.expression.setName(\"Expression\");\r\n        this.intimidation = ko.observable(json.intimidation).extend({ lockable: this.locked });\r\n        this.intimidation.setName(\"Intimidation\");\r\n        this.persuasion = ko.observable(json.persuasion).extend({ lockable: this.locked });\r\n        this.persuasion.setName(\"Persuasion\");\r\n        this.socialize = ko.observable(json.socialize).extend({ lockable: this.locked });\r\n        this.socialize.setName(\"Socialize\");\r\n        this.streetwise = ko.observable(json.streetwise).extend({ lockable: this.locked });\r\n        this.streetwise.setName(\"Streetwise\");\r\n        this.subterfuge = ko.observable(json.subterfuge).extend({ lockable: this.locked });\r\n        this.subterfuge.setName(\"Subterfuge\");\r\n\r\n        this.merits = ko.observableArray(json.merits.map(m => new Merit(m.name, m.value, this.locked)));\r\n        this.spells = ko.observableArray(json.spells.map(s => new Merit(s.name, s.value, this.locked)));\r\n        this.flaws = ko.observableArray(json.flaws.map(f => new Merit(f.name, f.value, this.locked)));\r\n\r\n        this.size = ko.observable(json.size).extend({ numeric: { precision: 0, min: 1, max: 10 }, lockable: this.locked });\r\n        this.speed = ko.computed(() => this.strength() + this.dexterity() + 5, this);\r\n        this.defense = ko.computed(() => Math.min(this.dexterity(), this.wits()), this);\r\n        this.armor = ko.observable(json.armor).extend({ numeric: { precision: 0 } }).extend({ lockable: this.locked });\r\n        this.initiative = ko.computed(() => this.dexterity() + this.composure(), this);\r\n        this.experience = ko.observable(json.experience).extend({ numeric: { precision: 0 }, lockable: this.locked });\r\n        this.morality = ko.observable(json.morality).extend({ numeric: { precision: 0, min: 1, max: 10 }, lockable: this.locked });\r\n\r\n        this.weapons = ko.observableArray(json.weapons.map(w => new Equipment(w.name, w.description, this.locked)));\r\n        this.equipment = ko.observableArray(json.equipment.map(e => new Equipment(e.name, e.description, this.locked)));\r\n        this.inventory = ko.observableArray(json.inventory.map(i => new InventoryItem(i.name, i.description, i.quantity, this.locked)));\r\n\r\n        this.notes = ko.observableArray(json.notes.map(n => new Note(n, this.locked)));\r\n\r\n        this.health = ko.computed(() => this.stamina() + this.size(), this);\r\n        this.damage = new Damage(this.health, json.bashing, json.lethal, json.aggravated, this.locked);\r\n\r\n        this.magic = ko.computed(() => this.resolve() + this.composure(), this);\r\n        this.usedMagic = ko.observable(json.usedMagic || 0).extend({ lockable: this.locked });\r\n        this.magic.subscribe(val => {\r\n            if (this.usedMagic() > val) CommandStack.instance.executeWithPrevious(new AttributeCommand(this.usedMagic, val, this.usedMagic()));\r\n        }, this);\r\n\r\n        this.willpower = ko.computed(() => this.resolve() + this.composure(), this);\r\n        this.usedWillpower = ko.observable(json.usedWillpower || 0).extend({ lockable: this.locked });\r\n        this.willpower.subscribe(val => {\r\n            if (this.usedWillpower() > val) CommandStack.instance.executeWithPrevious(new AttributeCommand(this.usedWillpower, val, this.usedWillpower()));\r\n        }, this);\r\n    }\r\n\r\n    public static newCharacter(): Character {\r\n        return new Character({\r\n            name: randomName(),\r\n            player: \"\",\r\n            age: 0,\r\n            vice: \"\",\r\n            virtue: \"\",\r\n            origins: \"\",\r\n            gender: \"\",\r\n            concept: \"\",\r\n            chronicle: \"\",\r\n\r\n            intelligence: 1,\r\n            strength: 1,\r\n            presence: 1,\r\n            wits: 1,\r\n            dexterity: 1,\r\n            manipulation: 1,\r\n            resolve: 1,\r\n            stamina: 1,\r\n            composure: 1,\r\n\r\n            academics: 0,\r\n            robotics: 0,\r\n            crafts: 0,\r\n            investigation: 0,\r\n            medicine: 0,\r\n            occult: 0,\r\n            politics: 0,\r\n            science: 0,\r\n\r\n            athletics: 0,\r\n            brawl: 0,\r\n            drive: 0,\r\n            ranged: 0,\r\n            larceny: 0,\r\n            stealth: 0,\r\n            survival: 0,\r\n            weaponry: 0,\r\n\r\n            animalKen: 0,\r\n            empathy: 0,\r\n            expression: 0,\r\n            intimidation: 0,\r\n            persuasion: 0,\r\n            socialize: 0,\r\n            streetwise: 0,\r\n            subterfuge: 0,\r\n\r\n            merits: [],\r\n            spells: [],\r\n            flaws: [],\r\n\r\n            size: 5,\r\n            armor: 0,\r\n            experience: 0,\r\n            morality: 7,\r\n\r\n            weapons: [],\r\n            equipment: [],\r\n            inventory: [],\r\n\r\n            notes: []\r\n        });\r\n    }\r\n\r\n    public static fromJson(json: CharacterJson): Character {\r\n        return new Character(json);\r\n    }\r\n\r\n    public onComponentClick(_: any, e: Event): void {\r\n        const element = <HTMLElement>e.currentTarget;\r\n        element.getElementsByTagName(\"input\")[0].focus();\r\n    }\r\n\r\n    public newItem<T>(observableArray: KnockoutObservableArray<T>, constructor: { createLockable(locked: KnockoutObservable<boolean>): T}): () => void {\r\n        return () => {\r\n            if (this.locked()) return;\r\n            CommandStack.instance.execute(new CollectionAddCommand(observableArray, constructor.createLockable(this.locked)));\r\n        };\r\n    }\r\n\r\n    public removeItem<T>(observableArray: KnockoutObservableArray<T>): (item: T) => void {\r\n        return (item: T) => {\r\n            if (this.locked()) return;\r\n            CommandStack.instance.execute(new CollectionRemoveCommand(observableArray, item));\r\n        };\r\n    }\r\n\r\n    public moveItem<T>(observableArray: KnockoutObservableArray<T>, direction: number): (item: T) => void {\r\n        return (item: T) => {\r\n            if (this.locked()) return;\r\n            const index = observableArray.indexOf(item);\r\n            const newIndex = index + direction;\r\n\r\n            if (newIndex < 0 || newIndex >= observableArray().length) return;\r\n\r\n            CommandStack.instance.execute(new CollectionMoveCommand(observableArray, item, newIndex, index));\r\n        };\r\n    }\r\n\r\n    public clearUsed(usedObservable: KnockoutObservable<number>): () => void {\r\n        return () => {\r\n            CommandStack.instance.execute(new ClearUsedCommand(usedObservable));\r\n        };\r\n    }\r\n\r\n    public toJson(): CharacterJson {\r\n        return {\r\n            name: this.name(),\r\n            player: this.player(),\r\n            age: this.age(),\r\n            vice: this.vice(),\r\n            virtue: this.virtue(),\r\n            origins: this.origins(),\r\n            gender: this.gender(),\r\n            concept: this.concept(),\r\n            chronicle: this.chronicle(),\r\n\r\n            intelligence: this.intelligence(),\r\n            wits: this.wits(),\r\n            resolve: this.resolve(),\r\n            strength: this.strength(),\r\n            dexterity: this.dexterity(),\r\n            stamina: this.stamina(),\r\n            presence: this.presence(),\r\n            manipulation: this.manipulation(),\r\n            composure: this.composure(),\r\n\r\n            bashing: this.damage.bashing(),\r\n            lethal: this.damage.lethal(),\r\n            aggravated: this.damage.aggravated(),\r\n            usedMagic: this.usedMagic(),\r\n            usedWillpower: this.usedWillpower(),\r\n\r\n            academics: this.academics(),\r\n            robotics: this.robotics(),\r\n            crafts: this.crafts(),\r\n            investigation: this.investigation(),\r\n            medicine: this.medicine(),\r\n            occult: this.occult(),\r\n            politics: this.politics(),\r\n            science: this.science(),\r\n\r\n            athletics: this.athletics(),\r\n            brawl: this.brawl(),\r\n            drive: this.drive(),\r\n            ranged: this.ranged(),\r\n            larceny: this.larceny(),\r\n            stealth: this.stealth(),\r\n            survival: this.survival(),\r\n            weaponry: this.weaponry(),\r\n\r\n            animalKen: this.animalKen(),\r\n            empathy: this.empathy(),\r\n            expression: this.expression(),\r\n            intimidation: this.intimidation(),\r\n            persuasion: this.persuasion(),\r\n            socialize: this.socialize(),\r\n            streetwise: this.streetwise(),\r\n            subterfuge: this.subterfuge(),\r\n\r\n            merits: this.merits().map(m => { return { name: m.name(), value: m.value() }; }),\r\n            spells: this.spells().map(s => { return { name: s.name(), value: s.value() }; }),\r\n            flaws: this.flaws().map(f => { return { name: f.name(), value: f.value() }; }),\r\n\r\n            size: this.size(),\r\n            armor: this.armor(),\r\n            experience: this.experience(),\r\n            morality: this.morality(),\r\n\r\n            weapons: this.weapons().map(w => { return { name: w.name(), description: w.description() }; }),\r\n            equipment: this.equipment().map(e => { return { name: e.name(), description: e.description() }; }),\r\n            inventory: this.inventory().map(i => { return { name: i.name(), description: i.description(), quantity: i.quantity() }; }),\r\n\r\n            notes: this.notes().map(n => n.value())\r\n        };\r\n    }\r\n}\r\n\r\nconst alphabet = \"abcdefghijklmnopqrstuvwxyz\";\r\nfunction randomName() {\r\n    const firstNameLength = randomInteger(5, 12);\r\n    const lastNameLength = randomInteger(5, 12);\r\n    let firstName = \"\";\r\n    let lastName = \"\";\r\n\r\n    for (let i = 0; i < firstNameLength; i++) {\r\n        let newLetter = alphabet.charAt(randomInteger(0, alphabet.length));\r\n        if (i === 0) newLetter = newLetter.toUpperCase();\r\n\r\n        firstName += newLetter;\r\n    }\r\n\r\n    for (let i = 0; i < lastNameLength; i++) {\r\n        let newLetter = alphabet.charAt(randomInteger(0, alphabet.length));\r\n        if (i === 0) newLetter = newLetter.toUpperCase();\r\n\r\n        lastName += newLetter;\r\n    }\r\n\r\n    return `${firstName} ${lastName}`;\r\n}\r\n\r\ntype CharacterJson = {\r\n    name: string,\r\n    player: string,\r\n    age: number,\r\n    vice: string,\r\n    virtue: string,\r\n    origins: string,\r\n    gender: string,\r\n    concept: string,\r\n    chronicle: string,\r\n\r\n    intelligence: number,\r\n    strength: number,\r\n    presence: number,\r\n    wits: number,\r\n    dexterity: number,\r\n    manipulation: number,\r\n    resolve: number,\r\n    stamina: number,\r\n    composure: number,\r\n\r\n    academics: number,\r\n    robotics: number,\r\n    crafts: number,\r\n    investigation: number,\r\n    medicine: number,\r\n    occult: number,\r\n    politics: number,\r\n    science: number,\r\n\r\n    athletics: number,\r\n    brawl: number,\r\n    drive: number,\r\n    ranged: number,\r\n    larceny: number,\r\n    stealth: number,\r\n    survival: number,\r\n    weaponry: number,\r\n\r\n    animalKen: number,\r\n    empathy: number,\r\n    expression: number,\r\n    intimidation: number,\r\n    persuasion: number,\r\n    socialize: number,\r\n    streetwise: number,\r\n    subterfuge: number,\r\n\r\n    merits: Array<{ name: string, value: number }>,\r\n    spells: Array<{ name: string, value: number }>,\r\n    flaws: Array<{ name: string, value: number }>,\r\n\r\n    size: number,\r\n    armor: number,\r\n    experience: number,\r\n    morality: number,\r\n\r\n    weapons: Array<{ name: string, description: string }>,\r\n    equipment: Array<{ name: string, description: string }>,\r\n    inventory: Array<{ name: string, description: string, quantity: number }>,\r\n\r\n    notes: Array<string>,\r\n\r\n    bashing?: number,\r\n    lethal?: number,\r\n    aggravated?: number,\r\n\r\n    usedMagic?: number,\r\n    usedWillpower?: number\r\n};","import CommandStack from \"../Command/CommandStack\";\r\nimport AttributeCommand from \"../Command/AttributeCommand\";\r\nimport BatchCommand from \"../Command/BatchCommand\";\r\n\r\nexport default class Damage {\r\n    public totalHealth: KnockoutComputed<number>;\r\n    public bashing: KnockoutObservable<number>;\r\n    public lethal: KnockoutObservable<number>;\r\n    public aggravated: KnockoutObservable<number>;\r\n\r\n    public constructor(totalHealthObservable: KnockoutComputed<number>, bashing?: number, lethal?: number, aggravated?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.totalHealth = totalHealthObservable;\r\n        this.bashing = ko.observable(bashing || 0);\r\n        this.lethal = ko.observable(lethal || 0);\r\n        this.aggravated = ko.observable(aggravated || 0);\r\n\r\n        if (locked) {\r\n            this.bashing = this.bashing.extend({ lockable: locked });\r\n            this.lethal = this.lethal.extend({ lockable: locked });\r\n            this.aggravated = this.aggravated.extend({ lockable: locked });\r\n        }\r\n\r\n        totalHealthObservable.subscribe(val => {\r\n            let bashing = this.bashing();\r\n            let lethal = this.lethal();\r\n            let aggravated = this.aggravated();\r\n            while (bashing + lethal + aggravated > val) {\r\n                if (bashing > 0) {\r\n                    bashing--;\r\n                }\r\n                else if (lethal > 0) {\r\n                    lethal--;\r\n                }\r\n                else {\r\n                    aggravated--;\r\n                }\r\n            }\r\n            CommandStack.instance.executeWithPrevious(new BatchCommand(\r\n                new AttributeCommand(this.bashing, bashing, this.bashing()),\r\n                new AttributeCommand(this.lethal, lethal, this.lethal()),\r\n                new AttributeCommand(this.aggravated, aggravated, this.aggravated())\r\n            ));\r\n        }, this);\r\n    }\r\n\r\n    public anyEmpty(): boolean {\r\n        return this.bashing() + this.lethal() + this.aggravated() < this.totalHealth();\r\n    }\r\n\r\n    public addBashing(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.bashing, this.bashing() + 1, this.bashing()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public addLethal(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public addAggravated(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public clearAll(): void {\r\n        CommandStack.instance.execute(new BatchCommand(\r\n            new AttributeCommand(this.bashing, 0, this.bashing()),\r\n            new AttributeCommand(this.lethal, 0, this.lethal()),\r\n            new AttributeCommand(this.aggravated, 0, this.aggravated())\r\n        ));\r\n    }\r\n}","export default class Equipment {\r\n    public name: KnockoutObservable<string>;\r\n    public description: KnockoutObservable<string>;\r\n\r\n    public constructor(name?: string, description?: string, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.description = ko.observable(description || \"\");\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.description = this.description.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Equipment(null, null, locked);\r\n    }\r\n}","export default class InventoryItem {\r\n    public name: KnockoutObservable<string>;\r\n    public description: KnockoutObservable<string>;\r\n    public quantity: KnockoutObservable<number>;\r\n    public displayText: KnockoutComputed<string>;\r\n\r\n    public constructor(name?: string, description?: string, quantity?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.description = ko.observable(description || \"\");\r\n        this.quantity = ko.observable(quantity || 1);\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.description = this.description.extend({ lockable: locked });\r\n            this.quantity = this.quantity.extend({ lockable: locked });\r\n        }\r\n\r\n        this.displayText = ko.computed(this.getDisplayText, this);\r\n    }\r\n\r\n    public getDisplayText() : string {\r\n        return `${this.quantity()} ${this.name()}`;\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new InventoryItem(null, null, null, locked);\r\n    }\r\n}","export default class Merit {\r\n    public name: KnockoutObservable<string>;\r\n    public value: KnockoutObservable<number>;\r\n\r\n    public constructor(name?: string, value?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.value = ko.observable(value || 0);\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.value = this.value.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Merit(null, null, locked);\r\n    }\r\n}","export default class Note {\r\n    public value: KnockoutObservable<string>;\r\n\r\n    public constructor(value?: string, locked?: KnockoutObservable<boolean>) {\r\n        this.value = ko.observable(value || \"\");\r\n\r\n        if (locked) {\r\n            this.value = this.value.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Note(null, locked);\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class AttributeCommand implements ICommand {\r\n    private _observable: KnockoutObservable<number>;\r\n    private _newValue: number;\r\n    private _oldValue: number;\r\n\r\n    public constructor(observable: KnockoutObservable<number>, newValue: number, oldValue: number) {\r\n        this._observable = observable;\r\n        this._newValue = newValue;\r\n        this._oldValue = oldValue;\r\n    }\r\n\r\n    public getType(): string { return \"AttributeCommand\"; }\r\n    public toString(): string {\r\n        return `${this._observable.getName()}: ${this._oldValue} => ${this._newValue}`;\r\n    }\r\n\r\n    public execute(): void {\r\n        this._observable(this._newValue);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newValue === this._oldValue;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class BatchCommand implements ICommand {\r\n    private _commands: ICommand[];\r\n\r\n    public constructor(...commands: ICommand[]) {\r\n        this._commands = commands.filter(command => !command.doesNothing());\r\n    }\r\n\r\n    public get commandCount(): number { return this._commands.length; }\r\n\r\n    public getType(): string { return \"BatchCommand\"; }\r\n\r\n    public getCommand(index: number): ICommand | null {\r\n        if (index < 0 || index >= this._commands.length) return null;\r\n\r\n        return this._commands[index];\r\n    }\r\n\r\n    public execute(): void {\r\n        for (let i = 0; i < this._commands.length; i++) this._commands[i].execute();\r\n    }\r\n\r\n    public undo(): void {\r\n        for (let i = this._commands.length - 1; i >= 0; i--) this._commands[i].undo();\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._commands.every(command => command.doesNothing());\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class ClearUsedCommand implements ICommand {\r\n    private _observable: KnockoutObservable<number>;\r\n    private _oldValue: number;\r\n\r\n    public constructor(observable: KnockoutObservable<number>) {\r\n        this._observable = observable;\r\n        this._oldValue = observable();\r\n    }\r\n\r\n    public getType(): string { return \"ClearUsedCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable(0);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._oldValue === 0;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionAddCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _newItem: T;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, newItem: T) {\r\n        this._observable = observable;\r\n        this._newItem = newItem;\r\n    }\r\n\r\n    public getType(): string { return \"CollectionAddCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.push(this._newItem);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.remove(this._newItem);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return false;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionMoveCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _item: T;\r\n    private _newIndex: number;\r\n    private _oldIndex: number;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, item: T, newIndex: number, oldIndex: number) {\r\n        this._observable = observable;\r\n        this._item = item;\r\n        this._newIndex = newIndex;\r\n        this._oldIndex = oldIndex;\r\n    }\r\n\r\n    public getType(): string { return \"CollectionMoveCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.splice(this._oldIndex, 1);\r\n        this._observable.splice(this._newIndex, 0, this._item);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.splice(this._newIndex, 1);\r\n        this._observable.splice(this._oldIndex, 0, this._item);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newIndex === this._oldIndex;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionRemoveCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _item: T;\r\n    private _itemIndex: number;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, item: T) {\r\n        this._observable = observable;\r\n        this._item = item;\r\n        this._itemIndex = this._observable.indexOf(this._item);\r\n    }\r\n\r\n    public getType(): string { return \"CollectionRemoveCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.remove(this._item);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.splice(this._itemIndex, 0, this._item);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return false;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\nimport BatchCommand from \"./BatchCommand\";\r\n\r\nexport default class CommandStack {\r\n    private static _instance: CommandStack;\r\n    \r\n    private _undoStack: KnockoutObservableArray<ICommand>;\r\n    private _redoStack: KnockoutObservableArray<ICommand>;\r\n    private _currentlyExecuting: boolean;\r\n\r\n    public canUndo: KnockoutComputed<boolean>;\r\n    public canRedo: KnockoutComputed<boolean>;\r\n\r\n    private constructor() {\r\n        this._undoStack = ko.observableArray([]);\r\n        this._redoStack = ko.observableArray([]);\r\n        this._currentlyExecuting = false;\r\n\r\n        this.canUndo = ko.computed(() => this.undoLength > 0, this);\r\n        this.canRedo = ko.computed(() => this.redoLength > 0, this);\r\n    }\r\n\r\n    public static get instance(): CommandStack {\r\n        if (!CommandStack._instance) CommandStack._instance = new CommandStack();\r\n\r\n        return CommandStack._instance;\r\n    }\r\n\r\n    public get undoLength(): number { return this._undoStack().length; }\r\n    public get redoLength(): number { return this._redoStack().length; }\r\n\r\n    public getPreviousCommand(drillIntoBatch: boolean = false): ICommand {\r\n        let previousCommand = this._undoStack()[this.undoLength - 1];\r\n\r\n        if (!drillIntoBatch) return previousCommand;\r\n\r\n        while (previousCommand instanceof BatchCommand) {\r\n            previousCommand = previousCommand.getCommand(previousCommand.commandCount - 1);\r\n        }\r\n\r\n        return previousCommand;\r\n    }\r\n\r\n    // TODO: Maybe don't have this as singleton...\r\n    // Could have an instance for each character\r\n    // to preserve the stack across character selection\r\n    public reset(): void {\r\n        this._undoStack.removeAll();\r\n        this._redoStack.removeAll();\r\n    }\r\n\r\n    public execute(command: ICommand): void {\r\n        if (command.doesNothing()) return;\r\n\r\n        if (this._currentlyExecuting) {\r\n            window.setTimeout(() => this.execute(command), 1);\r\n            return;\r\n        }\r\n\r\n        this._currentlyExecuting = true;\r\n        command.execute();\r\n        this._undoStack.push(command);\r\n        this._redoStack.removeAll();\r\n        this._currentlyExecuting = false;\r\n    }\r\n\r\n    public executeWithPrevious(command: ICommand): void {\r\n        if (command.doesNothing()) return;\r\n\r\n        if (this._currentlyExecuting) {\r\n            window.setTimeout(() => this.executeWithPrevious(command), 1);\r\n            return;\r\n        }\r\n\r\n        this._currentlyExecuting = true;\r\n        command.execute();\r\n        let previousCommand = this._undoStack.pop();\r\n        this._undoStack.push(new BatchCommand(previousCommand, command));\r\n        this._redoStack.removeAll();\r\n        this._currentlyExecuting = false;\r\n    }\r\n\r\n    public undo(): void {\r\n        if (this._undoStack().length === 0) return;\r\n        \r\n        const command = this._undoStack.pop();\r\n\r\n        command.undo();\r\n        this._redoStack.push(command);\r\n    }\r\n\r\n    public redo(): void {\r\n        if (this._redoStack().length === 0) return;\r\n\r\n        const command = this._redoStack.pop();\r\n        command.execute();\r\n        this._undoStack.push(command);\r\n    }\r\n\r\n    public log(): void {\r\n        console.log(\"UNDO STACK:\");\r\n        console.log(this._undoStack());\r\n        console.log(\"REDO STACK:\");\r\n        console.log(this._redoStack());\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class TextInputCommand implements ICommand {\r\n    private _observable: KnockoutObservable<string>;\r\n    private _newValue: string;\r\n    private _oldValue: string;\r\n\r\n    public constructor(observable: KnockoutObservable<string>, newValue: string, oldValue: string) {\r\n        this._observable = observable;\r\n        this._newValue = newValue;\r\n        this._oldValue = oldValue;\r\n    }\r\n\r\n    public getType(): string { return \"TextInputCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable(this._newValue);\r\n    }\r\n\r\n    public undo(): void  {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newValue === this._oldValue;\r\n    }\r\n}","import { randomFloat, randomInteger } from \"./utils\";\r\n\r\nexport default class Dice {\r\n    public dicePool: KnockoutObservable<number>;\r\n    public rollRounds: KnockoutObservableArray<Array<number>>;\r\n    public rollingInProgress: KnockoutObservable<boolean>;\r\n    public totalDiceSuccesses: KnockoutComputed<number>;\r\n    public totalDiceSuccessesDisplay: KnockoutComputed<string>;\r\n\r\n    public constructor() {\r\n        this.dicePool = ko.observable(1);\r\n        this.rollRounds = ko.observableArray([]);\r\n        this.rollingInProgress = ko.observable(false);\r\n        this.totalDiceSuccesses = ko.computed(() => {\r\n            if (this.rollingInProgress() || this.rollRounds().length === 0) return -1;\r\n\r\n            return this.rollRounds().reduce((total: number, r: Array<number>) => {\r\n                return total + r.reduce((total: number, d: number) => total + (d > 7 ? 1 : 0), 0);\r\n            }, 0);\r\n        }, this);\r\n        this.totalDiceSuccessesDisplay = ko.computed(() => {\r\n            return this.totalDiceSuccesses() >= 0 ? \"\" + this.totalDiceSuccesses() : \"???\";\r\n        }, this);\r\n    }\r\n\r\n    public incrementDicePool(amount: number): () => void {\r\n        return () => {\r\n            let newAmount = this.dicePool() + amount;\r\n            if (newAmount < 1) newAmount = 1;\r\n            this.dicePool(newAmount);\r\n        };\r\n    }\r\n\r\n    public rollDice(): void {\r\n        const roller = new RollState(this);\r\n        roller.beginRoll();\r\n    }\r\n}\r\n\r\nclass RollState {\r\n    private _diceObj: Dice;\r\n    private _currentRound: number;\r\n    private _currentDice: number;\r\n    private _currentRoundRolls: number;\r\n    private _currentRoundResults: Array<number>;\r\n    private _nextRoundRolls: number;\r\n    private _intervalHandle: number;\r\n\r\n    public constructor(diceObj: Dice) {\r\n        this._diceObj = diceObj;\r\n        this._currentRound = 0;\r\n        this._currentDice = 0;\r\n        this._currentRoundRolls = diceObj.dicePool();\r\n        this._currentRoundResults = [];\r\n        this._nextRoundRolls = 0;\r\n        this._intervalHandle = null;\r\n    }\r\n\r\n    public beginRoll(): void {\r\n        this._diceObj.rollingInProgress(true);\r\n        this._diceObj.rollRounds.removeAll();\r\n        for (let i = 0; i < this._currentRoundRolls; i++) this._currentRoundResults.push(-1);\r\n        this._diceObj.rollRounds.push(this._currentRoundResults);\r\n\r\n        this._intervalHandle = window.setInterval(() => {\r\n            const nextRoll = randomInteger(1, 11);\r\n            if (nextRoll === 10) {\r\n                this._nextRoundRolls++;\r\n                const diceContainer = document.getElementsByClassName(\"diceContainer\")[0];\r\n                const critMessage = document.createElement(\"div\");\r\n                critMessage.classList.add(\"crit-message\");\r\n                critMessage.innerText = \"Crit!\";\r\n                critMessage.id = \"critMessage\";\r\n                diceContainer.appendChild(critMessage);\r\n                window.setTimeout(() => diceContainer.removeChild(critMessage), 1010);\r\n            }\r\n            this._currentRoundResults[this._currentDice] = nextRoll;\r\n            this._diceObj.rollRounds.replace(this._diceObj.rollRounds()[this._currentRound], this._currentRoundResults);\r\n            this._currentDice++;\r\n\r\n            if (this._currentDice === this._currentRoundRolls) {\r\n                if (this._nextRoundRolls === 0) {\r\n                    window.clearInterval(this._intervalHandle);\r\n                    this._diceObj.rollingInProgress(false);\r\n                    const critMessage = document.getElementById(\"critMessage\");\r\n                    if (critMessage) {\r\n                        critMessage.remove();\r\n                    }\r\n                    return;\r\n                }\r\n                else {\r\n                    this._currentRound++;\r\n                    this._currentRoundRolls = this._nextRoundRolls;\r\n                    this._nextRoundRolls = 0;\r\n                    this._currentDice = 0;\r\n                    this._currentRoundResults = [];\r\n                    for (let i = 0; i < this._currentRoundRolls; i++) this._currentRoundResults.push(-1);\r\n                    this._diceObj.rollRounds.push(this._currentRoundResults);\r\n                }\r\n            }\r\n        }, 100);\r\n    }\r\n}","import Application from \"./Application\";\r\nimport Equipment from \"./Character/Equipment\";\r\nimport InventoryItem from \"./Character/InventoryItem\";\r\nimport Merit from \"./Character/Merit\";\r\nimport Note from \"./Character/Note\";\r\nimport { applyCustomKnockoutCode } from \"./utils\";\r\n\r\napplyCustomKnockoutCode();\r\n\r\nconst constructors = {\r\n    Equipment: Equipment,\r\n    InventoryItem: InventoryItem,\r\n    Merit: Merit,\r\n    Note: Note\r\n};\r\nObject.defineProperty(window, \"constructors\", { value: constructors });\r\n\r\nconst app = new Application();\r\nko.applyBindings(app);\r\n\r\n// Exposing the view model to the global state in case manual changes need to be applied\r\nObject.defineProperty(window, \"app\", { value: app });\r\n\r\nfunction toggleTooltips(enable: boolean): void {\r\n    if (enable) $(\"[data-toggle='tooltip']\").tooltip();\r\n    else $(\"[data-toggle='tooltip']\").tooltip(\"dispose\");\r\n}\r\n\r\nwindow.addEventListener(\"resize\", () => {\r\n    toggleTooltips(window.outerWidth >= 992);\r\n});\r\ntoggleTooltips(window.outerWidth >= 992);","import Damage from \"./Character/Damage\";\r\nimport CommandStack from \"./Command/CommandStack\";\r\nimport AttributeCommand from \"./Command/AttributeCommand\";\r\nimport TextInputCommand from \"./Command/TextInputCommand\";\r\n\r\nexport function randomInteger(minInclusive = 0, maxExclusive = 10): number {\r\n    if (maxExclusive < minInclusive) {\r\n        [minInclusive, maxExclusive] = [maxExclusive, minInclusive];\r\n    }\r\n\r\n    return Math.floor(Math.random() * (maxExclusive - minInclusive)) + minInclusive;\r\n}\r\n\r\nexport function randomFloat(minInclusive = 0, maxExclusive = 1): number {\r\n    if (maxExclusive < minInclusive) {\r\n        [minInclusive, maxExclusive] = [maxExclusive, minInclusive];\r\n    }\r\n\r\n    return Math.random() * (maxExclusive - minInclusive) + minInclusive;\r\n}\r\n\r\nconst _observableNameMap = new Map<KnockoutObservable<any>, string>();\r\nexport function applyCustomKnockoutCode() {\r\n    applyKnockoutBindings();\r\n    applyKnockoutExtenders();\r\n    applyKnockoutCustomFunctions();\r\n}\r\n\r\nfunction applyKnockoutBindings() {\r\n    ko.bindingHandlers.dice = {\r\n        update: (element: HTMLElement, valueAccessor: () => KnockoutObservableArray<Array<number>>) => {\r\n            const rollRounds = valueAccessor()();\r\n            if (rollRounds.length === 0) {\r\n                element.innerHTML = \"\";\r\n                return;\r\n            }\r\n    \r\n            let divs = element.getElementsByClassName(\"dice-round\");\r\n            if (divs.length !== rollRounds.length) {\r\n                const newRound = document.createElement(\"div\");\r\n                newRound.classList.add(\"dice-round\");\r\n                const rolls = rollRounds[rollRounds.length - 1];\r\n                for (let i = 0; i < rolls.length; i++) {\r\n                    const span = document.createElement(\"span\");\r\n                    const delay = randomFloat(0, 0.5);\r\n                    span.style.animation = `rollingDice 0.5s linear -${delay}s infinite alternate`;\r\n                    span.classList.add(\"dice\");\r\n                    newRound.appendChild(span);\r\n                }\r\n                element.appendChild(newRound);\r\n                divs = element.getElementsByClassName(\"dice-round\");\r\n            }\r\n    \r\n            for (let i = 0; i < rollRounds.length; i++) {\r\n                const rolls = rollRounds[i];\r\n                const spans = divs[i].getElementsByClassName(\"dice\");\r\n                for (let j = 0; j < rolls.length; j++) {\r\n                    const roll = rolls[j];\r\n                    const span = <HTMLSpanElement>spans[j];\r\n    \r\n                    if (roll !== -1) {\r\n                        span.style.animation = null;\r\n                        span.style.backgroundImage = `url('images/dice-${roll}.png')`;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.damageDisplay = {\r\n        init: (element: HTMLElement) => {\r\n            for (let i = 0; i < 15; i++) {\r\n                const span = document.createElement(\"span\");\r\n                span.classList.add(\"damage\");\r\n                span.classList.add(\"none\");\r\n                element.appendChild(span);\r\n            }\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => Damage) => {\r\n            const damageObj = valueAccessor();\r\n            const spans = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < spans.length; i++) {\r\n                if (i < damageObj.aggravated()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.add(\"aggravated\");\r\n                }\r\n                else if (i - damageObj.aggravated() < damageObj.lethal()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"lethal\");\r\n                }\r\n                else if (i - damageObj.aggravated() - damageObj.lethal() < damageObj.bashing()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"bashing\");\r\n                }\r\n                else {\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"none\");\r\n                }\r\n    \r\n                if (i < damageObj.totalHealth()) {\r\n                    spans[i].classList.remove(\"HIDDEN\");\r\n                }\r\n                else {\r\n                    spans[i].classList.add(\"HIDDEN\");\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.attribute = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number, canClear?: boolean }) => {\r\n            const dots: Array<HTMLSpanElement> = [];\r\n            for (let i = 0; i < valueAccessor().max; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                dot.classList.add(\"pointer\");\r\n                dot.dataset.toggle = \"tooltip\";\r\n                dot.title = \"\" + (i + 1);\r\n                $(dot).tooltip();\r\n    \r\n                dots.push(dot);\r\n    \r\n                dot.addEventListener(\"pointerenter\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                        if (index <= i) dot.classList.add(\"hoverFilled\");\r\n                    });\r\n                });\r\n                dot.addEventListener(\"pointerleave\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement) => {\r\n                        dot.classList.remove(\"hoverFilled\");\r\n                    });\r\n                });\r\n            }\r\n    \r\n            const canClear = valueAccessor().canClear;\r\n            if (canClear === true || typeof canClear === \"undefined\") {\r\n                const clearDot = document.createElement(\"div\");\r\n                clearDot.classList.add(\"clear-dot\");\r\n                clearDot.innerHTML = \"&times;\";\r\n                clearDot.dataset.toggle = \"tooltip\";\r\n                clearDot.title = \"Clear\";\r\n                clearDot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, 0, valueAccessor().value()));\r\n                });\r\n                element.appendChild(clearDot);\r\n                $(clearDot).tooltip();\r\n            }\r\n    \r\n            dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                element.appendChild(dot);\r\n                dot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, index + 1, valueAccessor().value()));\r\n                });\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number }) => {\r\n            const value = valueAccessor().value();\r\n            const dots = element.getElementsByClassName(\"attribute-dot\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                const dot = <HTMLSpanElement>dots[i];\r\n                dot.style.backgroundColor = null;\r\n                dot.style.borderColor = null;\r\n                if (i < value) {\r\n                    dot.style.backgroundColor = \"var(--body-color)\";\r\n                    dot.style.borderColor = \"var(--body-color)\";\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.readOnlyAttribute = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number }) => {\r\n            for (let i = 0; i < valueAccessor().max; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                element.appendChild(dot);\r\n            }\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number, hideUnfilled?: boolean }) => {\r\n            const value = valueAccessor().value();\r\n            const dots = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                dots[i].classList.remove(\"filled\");\r\n                if (i < value) {\r\n                    dots[i].classList.add(\"filled\");\r\n                    dots[i].classList.remove(\"HIDDEN\");\r\n                }\r\n                else if (valueAccessor().hideUnfilled) {\r\n                    dots[i].classList.add(\"HIDDEN\");\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.used = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, total: KnockoutComputed<number> }) => {\r\n            const dots: Array<HTMLSpanElement> = [];\r\n            for (let i = 0; i < 12; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                element.appendChild(dot);\r\n    \r\n                dots.push(dot);\r\n    \r\n                dot.addEventListener(\"pointerenter\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                        if (index <= i) dot.classList.add(\"hoverFilled\");\r\n                    });\r\n                });\r\n                dot.addEventListener(\"pointerleave\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement) => {\r\n                        dot.classList.remove(\"hoverFilled\");\r\n                    });\r\n                });\r\n            }\r\n            dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                dot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, index + 1, valueAccessor().value()));\r\n                });\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, total: KnockoutComputed<number> }) => {\r\n            const used = valueAccessor().value();\r\n            const total = valueAccessor().total();\r\n            const dots = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                if (i < used) dots[i].classList.add(\"filled-red\");\r\n                else dots[i].classList.remove(\"filled-red\");\r\n    \r\n                if (i < total) dots[i].classList.remove(\"HIDDEN\");\r\n                else dots[i].classList.add(\"HIDDEN\");\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.focusOnCreation = {\r\n        init: (element: HTMLInputElement | HTMLTextAreaElement) => {\r\n            window.setTimeout(() => {\r\n                if (element.value) return;\r\n                element.focus();\r\n            }, 1);\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.contextMenu = {\r\n        init: (element: HTMLElement, valueAccessor: () => () => void) => {\r\n            element.addEventListener(\"contextmenu\", e => {\r\n                e.preventDefault();\r\n                valueAccessor()();\r\n            });\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.undoableTextInput = {\r\n        init: (element: HTMLElement, valueAccessor: () => KnockoutObservable<string>) => {\r\n            const inputElement = <HTMLInputElement>element;\r\n            inputElement.addEventListener(\"change\", () => {\r\n                const oldValue = valueAccessor()();\r\n                const newValue = inputElement.value;\r\n                if (oldValue === newValue) return;\r\n\r\n                valueAccessor()(newValue);\r\n                if (valueAccessor()() === oldValue) return;\r\n                valueAccessor()(oldValue);\r\n\r\n                CommandStack.instance.execute(new TextInputCommand(valueAccessor(), newValue, oldValue));\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => KnockoutObservable<string>) => {\r\n            (<HTMLInputElement>element).value = valueAccessor()();\r\n        }\r\n    };\r\n}\r\nfunction applyKnockoutExtenders() {\r\n    ko.extenders.named = <T>(target: KnockoutObservable<T>, name: string) => {\r\n        // TODO: This requires that the `named` extension be the last one listed.\r\n        // It's messy and also inefficient because there will be multiple instances\r\n        // of the same observable property on a character equal to the number of\r\n        // characters the user has. I will need to come up with a different way,\r\n        // but for now this works as a proof of concept.\r\n        _observableNameMap.set(target, name);\r\n        return target;\r\n    };\r\n\r\n    ko.extenders.lockable = <T>(target: KnockoutObservable<T>, locked: KnockoutObservable<boolean>) => {\r\n        const result = ko.pureComputed({\r\n            read: target,\r\n            write: (newValue: T) => {\r\n                if (locked()) {\r\n                    target.notifySubscribers(target());\r\n                }\r\n                else {\r\n                    target(newValue);\r\n                    target.notifySubscribers(newValue);\r\n                }\r\n            }\r\n        }).extend({ notify: \"always\" });\r\n    \r\n        return result;\r\n    };\r\n    \r\n    ko.extenders.numeric = (target: KnockoutObservable<number>, args: { precision?: number, min?: number, max?: number }) => {\r\n        const precision = args.precision || 0;\r\n        const min = args.min || -Infinity;\r\n        const max = args.max || Infinity;\r\n    \r\n        // Create a writeable computed observable to intercept writes to our observable\r\n        const result = ko.pureComputed({\r\n            read: target, // Always return the original observable's value\r\n            write: (newValue: number) => {\r\n                const current = target();\r\n                const roundingMultiplier = Math.pow(10, precision);\r\n                const newValueAsNum = isNaN(newValue) ? 0 : +newValue;\r\n                let valueToWrite = Math.round(newValueAsNum * roundingMultiplier) / roundingMultiplier;\r\n                if (valueToWrite < min) valueToWrite = min;\r\n                else if (valueToWrite > max) valueToWrite = max;\r\n    \r\n                // Only write if it changed\r\n                if (valueToWrite !== current) {\r\n                    target(valueToWrite);\r\n                }\r\n                else {\r\n                    // If the rounded value is the same, but a different value was written,\r\n                    // force a notification for the current field\r\n                    if (newValue !== current) {\r\n                        target.notifySubscribers(valueToWrite);\r\n                    }\r\n                }\r\n            }\r\n        }).extend({ notify: \"always\" });\r\n    \r\n        // Initialize with current value to make sure it is rounded appropriately\r\n        result(target());\r\n    \r\n        // Return the new computed observable\r\n        return result;\r\n    };\r\n}\r\nfunction applyKnockoutCustomFunctions() {\r\n    ko.subscribable.fn.getName = function () {\r\n        return _observableNameMap.get(this);\r\n    };\r\n}"]}