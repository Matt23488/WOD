{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/client/Application.ts","src/client/Character/Character.ts","src/client/Character/Damage.ts","src/client/Character/Equipment.ts","src/client/Character/InventoryItem.ts","src/client/Character/Merit.ts","src/client/Character/Note.ts","src/client/Character/Repository/CookieCharacterRepository.ts","src/client/Character/Repository/DummyCharacterRepository.ts","src/client/Character/Repository/ICharacterRepository.ts","src/client/Character/Repository/LocalStorageCharacterRepository.ts","src/client/Command/AttributeCommand.ts","src/client/Command/BatchCommand.ts","src/client/Command/ClearUsedCommand.ts","src/client/Command/CollectionAddCommand.ts","src/client/Command/CollectionMoveCommand.ts","src/client/Command/CollectionRemoveCommand.ts","src/client/Command/CommandStack.ts","src/client/Command/TextInputCommand.ts","src/client/Dice.ts","src/client/Keyboard.ts","src/client/main.ts","src/client/utils.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Character_1","Dice_1","CommandStack_1","ICharacterRepository_1","Keyboard_1","Application","prototype","toggleClock","this","showClock","goBack","mode","_previousSection","window","location","hash","newCharacter","newChar","default","locked","characters","push","selectCharacter","character","charIndex","indexOf","characterId","instance","reset","deleteCharacter","_this","swal","title","name","text","icon","buttons","dangerMode","then","willDelete","id","remove","saveCharacters","_characterRepo","realCharacters","timer","downloadCharacter","json","JSON","stringify","toJson","dl","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild","uploadCharacter","ul","type","accept","addEventListener","file","files","reader","FileReader","onload","target","result","fromJson","parse","readAsText","toggleCharacterLock","switchMode","getElementById","undo","canUndo","redo","canRedo","getCharacterRepository","connection","savedCharacters","loadCharacters","unshift","ghost","ko","observable","observableArray","computed","filter","dice","lockButtonClass","lockButtonIcon","currentTime","Date","currentTimeDisplay","time","hours","getHours","minutes","getMinutes","seconds","getSeconds","suffix","setInterval","registerKeyboardCommand","log","WebSocket","MozWebSocket","joined","userName","prompt","send","value","error","console","message","data","info","screenName","close","substring","$domElement","$","scrollTop","offset","top","Damage_1","Equipment_1","InventoryItem_1","Merit_1","Note_1","utils_1","CollectionAddCommand_1","CollectionRemoveCommand_1","CollectionMoveCommand_1","ClearUsedCommand_1","AttributeCommand_1","Character","firstNameLength","randomInteger","lastNameLength","firstName","lastName","newLetter","alphabet","charAt","toUpperCase","randomName","player","age","vice","virtue","origins","gender","concept","chronicle","intelligence","strength","presence","wits","dexterity","manipulation","resolve","stamina","composure","academics","robotics","crafts","investigation","medicine","occult","politics","science","athletics","brawl","drive","ranged","larceny","stealth","survival","weaponry","animalKen","empathy","expression","intimidation","persuasion","socialize","streetwise","subterfuge","merits","spells","flaws","size","armor","experience","morality","weapons","equipment","inventory","notes","onComponentClick","_","currentTarget","getElementsByTagName","focus","newItem","constructor","execute","createLockable","removeItem","item","moveItem","direction","index","newIndex","clearUsed","usedObservable","bashing","damage","lethal","aggravated","usedMagic","usedWillpower","map","m","s","w","description","quantity","extend","lockable","named","numeric","precision","min","max","speed","defense","Math","initiative","health","magic","subscribe","val","executeWithPrevious","willpower","BatchCommand_1","Damage","anyEmpty","totalHealth","addBashing","alert","addLethal","addAggravated","clearAll","totalHealthObservable","Equipment","InventoryItem","getDisplayText","displayText","Merit","Note","cookie","characterCookiePrefix","characterListCookieKey","CookieCharacterRepository","_characterIds","_b","__values","_c","next","done","key","oldId","removeCookie","DummyCharacterRepository","LocalStorageCharacterRepository_1","DummyCharacterRepository_1","CookieCharacterRepository_1","args","_i","arguments","IsSupported","button","LocalStorageCharacterRepository","localStorage","getItem","setItem","Object","defineProperty","test","AttributeCommand","getType","toString","_observable","getName","_oldValue","_newValue","doesNothing","newValue","oldValue","BatchCommand","_commands","getCommand","every","command","commands","ClearUsedCommand","CollectionAddCommand","_newItem","CollectionMoveCommand","splice","_oldIndex","_newIndex","_item","oldIndex","CollectionRemoveCommand","_itemIndex","CommandStack","_instance","_undoStack","_redoStack","getPreviousCommand","drillIntoBatch","previousCommand","undoLength","commandCount","removeAll","_currentlyExecuting","setTimeout","pop","redoLength","TextInputCommand","Dice","incrementDicePool","amount","newAmount","dicePool","rollDice","RollState","beginRoll","rollRounds","rollingInProgress","totalDiceSuccesses","reduce","total","d","totalDiceSuccessesDisplay","_diceObj","_currentRoundRolls","_currentRoundResults","_intervalHandle","nextRoll","_nextRoundRolls","diceContainer_1","getElementsByClassName","critMessage_1","classList","add","innerText","_currentDice","replace","_currentRound","clearInterval","critMessage","diceObj","_keyboardCommands","Map","callback","set","ctrlKey","entries","_d","__read","preventDefault","Application_1","applyCustomKnockoutCode","constructors","app","toggleTooltips","enable","tooltip","applyBindings","outerWidth","TextInputCommand_1","randomFloat","minInclusive","maxExclusive","_a","random","floor","_observableNameMap","bindingHandlers","update","element","valueAccessor","divs","newRound","rolls","span","delay","animation","spans","j","roll","backgroundImage","innerHTML","damageDisplay","init","damageObj","attribute","dots","dot","dataset","toggle","forEach","canClear","clearDot","backgroundColor","borderColor","readOnlyAttribute","hideUnfilled","used","focusOnCreation","contextMenu","undoableTextInput","inputElement","extenders","pureComputed","read","write","notifySubscribers","notify","Infinity","current","roundingMultiplier","pow","newValueAsNum","isNaN","valueToWrite","round","subscribable","fn","get"],"mappings":"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","file":"app.bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import Character from \"./Character/Character\";\r\nimport Dice from \"./Dice\";\r\n// import swal from \"sweetalert\";\r\nimport CommandStack from \"./Command/CommandStack\";\r\nimport ICharacterRepository, { getCharacterRepository } from \"./Character/Repository/ICharacterRepository\";\r\nimport { registerKeyboardCommand } from \"./Keyboard\";\r\n\r\nexport default class Application {\r\n    private _characterRepo: ICharacterRepository;\r\n    public mode: KnockoutObservable<string>;\r\n    public characterId: KnockoutObservable<number>;\r\n    public characters: KnockoutObservableArray<Character>;\r\n    public realCharacters: KnockoutComputed<Array<Character>>;\r\n    public character: KnockoutComputed<Character>;\r\n    public dice: Dice;\r\n    public lockButtonClass: KnockoutComputed<string>;\r\n    public lockButtonIcon: KnockoutComputed<string>;\r\n    private _previousSection: string;\r\n    public showClock: KnockoutObservable<boolean>;\r\n    public currentTime: KnockoutObservable<Date>;\r\n    public currentTimeDisplay: KnockoutComputed<string>;\r\n    public canUndo: KnockoutComputed<boolean>;\r\n    public canRedo: KnockoutComputed<boolean>;\r\n\r\n    public constructor() {\r\n        this._characterRepo = getCharacterRepository(\"LocalStorage\");\r\n\r\n        const savedCharacters = this._characterRepo.loadCharacters();\r\n        savedCharacters.unshift(Character.newCharacter());\r\n        savedCharacters[0].ghost = true;\r\n\r\n        this.mode = ko.observable(\"list\");\r\n        this.characterId = ko.observable(0);\r\n        this.characters = ko.observableArray(savedCharacters);\r\n        this.realCharacters = ko.computed(() => this.characters().filter(c => !c.ghost), this);\r\n        this.character = ko.computed(() => this.characters()[this.characterId()], this);\r\n        this.dice = new Dice();\r\n        this.lockButtonClass = ko.computed(() => this.character().locked() ? \"btn-danger\" : \"btn-outline-success\", this);\r\n        this.lockButtonIcon = ko.computed(() => this.character().locked() ? \"fas fa-lock\" : \"fas fa-lock-open\", this);\r\n        this._previousSection = null;\r\n        this.showClock = ko.observable(false);\r\n        this.currentTime = ko.observable(new Date());\r\n\r\n        this.currentTimeDisplay = ko.computed(() => {\r\n            const time = this.currentTime();\r\n            let hours = time.getHours();\r\n            const minutes = time.getMinutes();\r\n            const seconds = time.getSeconds();\r\n            const suffix = hours < 12 ? \"AM\" : \"PM\";\r\n            const minutePrefix = minutes < 10 ? \"0\" : \"\";\r\n            const secondPrefix = seconds < 10 ? \"0\" : \"\";\r\n            if (hours > 12) hours -= 12;\r\n            else if (hours === 0) hours = 12;\r\n            return `${hours}:${minutePrefix}${minutes}:${secondPrefix}${seconds} ${suffix}`;\r\n        }, this);\r\n\r\n        this.canUndo = ko.computed(() => CommandStack.instance.canUndo() && !this.character().locked(), this);\r\n        this.canRedo = ko.computed(() => CommandStack.instance.canRedo() && !this.character().locked(), this);\r\n\r\n        window.setInterval(() => {\r\n            this.currentTime(new Date());\r\n        }, 1000);\r\n\r\n        registerKeyboardCommand(\"s\", () => this.saveCharacters());\r\n        registerKeyboardCommand(\"z\", () => { \r\n            if (this.mode() === \"list\") return;\r\n            this.undo();\r\n        });\r\n        registerKeyboardCommand(\"Z\", () => {\r\n            if (this.mode() === \"list\") return;\r\n            this.redo();\r\n        });\r\n        registerKeyboardCommand(\"l\", () => {\r\n            if (this.mode() === \"list\") return;\r\n            this.toggleCharacterLock();\r\n        });\r\n        registerKeyboardCommand(\"o\", () => this.toggleClock());\r\n        registerKeyboardCommand(\"q\", () => CommandStack.instance.log());\r\n\r\n        // TODO: abstract this code\r\n        window.WebSocket = window.WebSocket || window.MozWebSocket;\r\n\r\n        let connection: WebSocket;\r\n        let joined = false;\r\n        registerKeyboardCommand(\"j\", () => {\r\n            if (joined) return;\r\n\r\n            connection = new WebSocket(\"ws://localhost:3001\");\r\n\r\n            connection.addEventListener(\"open\", () => {\r\n                joined = true;\r\n                const userName = prompt(\"Your Name?\");\r\n                connection.send(JSON.stringify({ type: \"name\", value: userName }));\r\n            });\r\n\r\n            connection.addEventListener(\"error\", error => {\r\n                console.error(\"Could not connect to chat server.\");\r\n            });\r\n\r\n            connection.addEventListener(\"message\", message => {\r\n                try {\r\n                    const json = JSON.parse(message.data);\r\n                    if (json.type === \"connect\" || json.type === \"disconnect\") {\r\n                        console.info(json.message);\r\n                    }\r\n                    else if (json.type === \"message\") {\r\n                        console.log(`${json.screenName}: ${json.message}`);\r\n                    }\r\n                    else if (json.type === \"error\") {\r\n                        console.error(json.message);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    console.error (`This doesn't look like valid JSON: ${message.data}`);\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n\r\n        registerKeyboardCommand(\"m\", () => {\r\n            if (!joined) return;\r\n\r\n            const message = prompt(\"Message?\");\r\n            connection.send(JSON.stringify({ type: \"message\", value: message }));\r\n        });\r\n\r\n        registerKeyboardCommand(\"J\", () => {\r\n            if (!joined) return;\r\n\r\n            connection.close();\r\n            joined = false;\r\n        });\r\n\r\n        window.addEventListener(\"hashchange\", e => {\r\n            const hash = window.location.hash.substring(1);\r\n            if (!hash) return;\r\n\r\n            var offset = 80; // TODO: Don't hardcode this maybe?\r\n            var $domElement = $(`#${hash}`);\r\n            $(window).scrollTop($domElement.offset().top - offset);\r\n        });\r\n    }\r\n\r\n    public toggleClock(): void {\r\n        this.showClock(!this.showClock());\r\n    }\r\n\r\n    public goBack(): void {\r\n        if (this.mode() === \"sheet\") this.mode(\"list\");\r\n        else {\r\n            this.mode(\"sheet\");\r\n\r\n            if (this._previousSection) window.location.hash = this._previousSection;\r\n        }\r\n    }\r\n\r\n    public newCharacter(): void {\r\n        const newChar = Character.newCharacter();\r\n        newChar.locked(false);\r\n        this.characters.push(newChar);\r\n        this.selectCharacter(newChar);\r\n    }\r\n\r\n    public selectCharacter(character: Character): void {\r\n        const charIndex = this.characters.indexOf(character);\r\n        if (this.characterId() !== charIndex) {\r\n            this.characterId(charIndex);\r\n            CommandStack.instance.reset();\r\n        }\r\n        this.mode(\"sheet\");\r\n    }\r\n\r\n    public deleteCharacter(character: Character): void {\r\n        if (this.character().locked()) return;\r\n        swal({\r\n            title: `Delete ${this.character().name()}`,\r\n            text: \"Are you sure? (As long as you don't save, your character won't be gone.)\",\r\n            icon: \"warning\",\r\n            buttons: [\"Cancel\", \"Delete\"],\r\n            dangerMode: true\r\n        })\r\n        .then((willDelete: boolean) => {\r\n            if (willDelete) {\r\n                const id = this.characterId();\r\n                this.characterId(0);\r\n                this.characters.remove(this.characters()[id]);\r\n                this.mode(\"list\");\r\n            }\r\n        });\r\n    }\r\n\r\n    public saveCharacters(): void {\r\n        this._characterRepo.saveCharacters(this.realCharacters());\r\n        swal(\"Characters saved successfully!\", {\r\n            buttons: {},\r\n            timer: 1000,\r\n            icon: \"success\"\r\n        });\r\n    }\r\n\r\n    public downloadCharacter(): void {\r\n        const json = JSON.stringify(this.character().toJson());\r\n\r\n        const dl = document.createElement(\"a\");\r\n        dl.setAttribute(\"href\", `data:text/plain;charset=utf-8,${encodeURIComponent(json)}`);\r\n        dl.setAttribute(\"download\", `${this.character().name()}.json`);\r\n\r\n        dl.style.display = \"none\";\r\n        document.body.appendChild(dl);\r\n\r\n        dl.click();\r\n\r\n        document.body.removeChild(dl);\r\n    }\r\n\r\n    public uploadCharacter(): void {\r\n        const ul = document.createElement(\"input\");\r\n        ul.type = \"file\";\r\n        ul.accept = \".json\";\r\n        ul.style.display = \"none\";\r\n\r\n        ul.addEventListener(\"change\", e => {\r\n            const file = ul.files[0];\r\n            if (!file) return;\r\n\r\n            const reader = new FileReader();\r\n            reader.onload = (e: any) => {\r\n                const json = e.target.result;\r\n                this.characters.push(Character.fromJson(JSON.parse(json)));\r\n                this.characterId(this.characters().length - 1);\r\n                this.mode(\"sheet\");\r\n            };\r\n            reader.readAsText(file);\r\n        });\r\n\r\n        document.body.appendChild(ul);\r\n\r\n        ul.click();\r\n\r\n        document.body.removeChild(ul);\r\n    }\r\n\r\n    public toggleCharacterLock(): void {\r\n        const character = this.character();\r\n        character.locked(!character.locked());\r\n    }\r\n\r\n    public switchMode(mode: string): () => void {\r\n        return () => {\r\n            if (this.mode() !== \"list\" && document.getElementById(mode)) {\r\n                this._previousSection = mode;\r\n            }\r\n            else this._previousSection = null;\r\n\r\n            window.location.hash = \"\";\r\n            this.mode(mode);\r\n        }\r\n    }\r\n\r\n    public undo(): void {\r\n        if (!this.canUndo()) return;\r\n        CommandStack.instance.undo();\r\n    }\r\n\r\n    public redo(): void {\r\n        if (!this.canRedo()) return;\r\n        CommandStack.instance.redo();\r\n    }\r\n}","import Damage from \"./Damage\";\r\nimport Equipment from \"./Equipment\";\r\nimport InventoryItem from \"./InventoryItem\";\r\nimport Merit from \"./Merit\";\r\nimport Note from \"./Note\";\r\nimport { randomInteger } from \"../utils\";\r\nimport CommandStack from \"../Command/CommandStack\";\r\nimport CollectionAddCommand from \"../Command/CollectionAddCommand\";\r\nimport CollectionRemoveCommand from \"../Command/CollectionRemoveCommand\";\r\nimport CollectionMoveCommand from \"../Command/CollectionMoveCommand\";\r\nimport ClearUsedCommand from \"../Command/ClearUsedCommand\";\r\nimport AttributeCommand from \"../Command/AttributeCommand\";\r\n\r\nexport default class Character {\r\n    public ghost: boolean = false;\r\n    public locked: KnockoutObservable<boolean> = ko.observable(true);\r\n\r\n    public name: KnockoutObservable<string>;\r\n    public player: KnockoutObservable<string>;\r\n    public age: KnockoutObservable<number>;\r\n    public vice: KnockoutObservable<string>;\r\n    public virtue: KnockoutObservable<string>;\r\n    public origins: KnockoutObservable<string>;\r\n    public gender: KnockoutObservable<string>;\r\n    public concept: KnockoutObservable<string>;\r\n    public chronicle: KnockoutObservable<string>;\r\n\r\n    public intelligence: KnockoutObservable<number>;\r\n    public strength: KnockoutObservable<number>;\r\n    public presence: KnockoutObservable<number>;\r\n    public wits: KnockoutObservable<number>;\r\n    public dexterity: KnockoutObservable<number>;\r\n    public manipulation: KnockoutObservable<number>;\r\n    public resolve: KnockoutObservable<number>;\r\n    public stamina: KnockoutObservable<number>;\r\n    public composure: KnockoutObservable<number>;\r\n\r\n    public academics: KnockoutObservable<number>;\r\n    public robotics: KnockoutObservable<number>;\r\n    public crafts: KnockoutObservable<number>;\r\n    public investigation: KnockoutObservable<number>;\r\n    public medicine: KnockoutObservable<number>;\r\n    public occult: KnockoutObservable<number>;\r\n    public politics: KnockoutObservable<number>;\r\n    public science: KnockoutObservable<number>;\r\n    \r\n    public athletics: KnockoutObservable<number>;\r\n    public brawl: KnockoutObservable<number>;\r\n    public drive: KnockoutObservable<number>;\r\n    public ranged: KnockoutObservable<number>;\r\n    public larceny: KnockoutObservable<number>;\r\n    public stealth: KnockoutObservable<number>;\r\n    public survival: KnockoutObservable<number>;\r\n    public weaponry: KnockoutObservable<number>;\r\n\r\n    public animalKen: KnockoutObservable<number>;\r\n    public empathy: KnockoutObservable<number>;\r\n    public expression: KnockoutObservable<number>;\r\n    public intimidation: KnockoutObservable<number>;\r\n    public persuasion: KnockoutObservable<number>;\r\n    public socialize: KnockoutObservable<number>;\r\n    public streetwise: KnockoutObservable<number>;\r\n    public subterfuge: KnockoutObservable<number>;\r\n\r\n    public merits: KnockoutObservableArray<Merit>;\r\n    public spells: KnockoutObservableArray<Merit>;\r\n    public flaws: KnockoutObservableArray<Merit>;\r\n\r\n    public size: KnockoutObservable<number>;\r\n    public speed: KnockoutComputed<number>;\r\n    public defense: KnockoutComputed<number>;\r\n    public armor: KnockoutObservable<number>;\r\n    public initiative: KnockoutComputed<number>;\r\n    public experience: KnockoutObservable<number>;\r\n    public morality: KnockoutObservable<number>;\r\n\r\n    public weapons: KnockoutObservableArray<Equipment>;\r\n    public equipment: KnockoutObservableArray<Equipment>;\r\n    public inventory: KnockoutObservableArray<InventoryItem>;\r\n\r\n    public notes: KnockoutObservableArray<Note>;\r\n\r\n    public health: KnockoutComputed<number>;\r\n    public damage: Damage;\r\n\r\n    public magic: KnockoutComputed<number>;\r\n    public usedMagic: KnockoutObservable<number>;\r\n\r\n    public willpower: KnockoutComputed<number>;\r\n    public usedWillpower: KnockoutObservable<number>;\r\n\r\n    public constructor(json: CharacterJson) {\r\n        this.name = ko.observable(json.name).extend({ lockable: this.locked, named: \"Name\" });\r\n        this.player = ko.observable(json.player).extend({ lockable: this.locked });\r\n        this.age = ko.observable(json.age).extend({ numeric: { precision: 0 }, lockable: this.locked });\r\n        this.vice = ko.observable(json.vice).extend({ lockable: this.locked });\r\n        this.virtue = ko.observable(json.virtue).extend({ lockable: this.locked });\r\n        this.origins = ko.observable(json.origins).extend({ lockable: this.locked });\r\n        this.gender = ko.observable(json.gender).extend({ lockable: this.locked });\r\n        this.concept = ko.observable(json.concept).extend({ lockable: this.locked });\r\n        this.chronicle = ko.observable(json.chronicle).extend({ lockable: this.locked });\r\n\r\n        this.intelligence = ko.observable(json.intelligence).extend({ lockable: this.locked, named: \"Intelligence\" });\r\n        this.strength = ko.observable(json.strength).extend({ lockable: this.locked });\r\n        this.presence = ko.observable(json.presence).extend({ lockable: this.locked });\r\n        this.wits = ko.observable(json.wits).extend({ lockable: this.locked });\r\n        this.dexterity = ko.observable(json.dexterity).extend({ lockable: this.locked });\r\n        this.manipulation = ko.observable(json.manipulation).extend({ lockable: this.locked });\r\n        this.resolve = ko.observable(json.resolve).extend({ lockable: this.locked });\r\n        this.stamina = ko.observable(json.stamina).extend({ lockable: this.locked });\r\n        this.composure = ko.observable(json.composure).extend({ lockable: this.locked });\r\n\r\n        this.academics = ko.observable(json.academics).extend({ lockable: this.locked });\r\n        this.robotics = ko.observable(json.robotics).extend({ lockable: this.locked });\r\n        this.crafts = ko.observable(json.crafts).extend({ lockable: this.locked });\r\n        this.investigation = ko.observable(json.investigation).extend({ lockable: this.locked });\r\n        this.medicine = ko.observable(json.medicine).extend({ lockable: this.locked });\r\n        this.occult = ko.observable(json.occult).extend({ lockable: this.locked });\r\n        this.politics = ko.observable(json.politics).extend({ lockable: this.locked });\r\n        this.science = ko.observable(json.science).extend({ lockable: this.locked });\r\n\r\n        this.athletics = ko.observable(json.athletics).extend({ lockable: this.locked });\r\n        this.brawl = ko.observable(json.brawl).extend({ lockable: this.locked });\r\n        this.drive = ko.observable(json.drive).extend({ lockable: this.locked });\r\n        this.ranged = ko.observable(json.ranged).extend({ lockable: this.locked });\r\n        this.larceny = ko.observable(json.larceny).extend({ lockable: this.locked });\r\n        this.stealth = ko.observable(json.stealth).extend({ lockable: this.locked });\r\n        this.survival = ko.observable(json.survival).extend({ lockable: this.locked });\r\n        this.weaponry = ko.observable(json.weaponry).extend({ lockable: this.locked });\r\n\r\n        this.animalKen = ko.observable(json.animalKen).extend({ lockable: this.locked });\r\n        this.empathy = ko.observable(json.empathy).extend({ lockable: this.locked });\r\n        this.expression = ko.observable(json.expression).extend({ lockable: this.locked });\r\n        this.intimidation = ko.observable(json.intimidation).extend({ lockable: this.locked });\r\n        this.persuasion = ko.observable(json.persuasion).extend({ lockable: this.locked });\r\n        this.socialize = ko.observable(json.socialize).extend({ lockable: this.locked });\r\n        this.streetwise = ko.observable(json.streetwise).extend({ lockable: this.locked });\r\n        this.subterfuge = ko.observable(json.subterfuge).extend({ lockable: this.locked });\r\n\r\n        this.merits = ko.observableArray(json.merits.map(m => new Merit(m.name, m.value, this.locked)));\r\n        this.spells = ko.observableArray(json.spells.map(s => new Merit(s.name, s.value, this.locked)));\r\n        this.flaws = ko.observableArray(json.flaws.map(f => new Merit(f.name, f.value, this.locked)));\r\n\r\n        this.size = ko.observable(json.size).extend({ numeric: { precision: 0, min: 1, max: 10 }, lockable: this.locked });\r\n        this.speed = ko.computed(() => this.strength() + this.dexterity() + 5, this);\r\n        this.defense = ko.computed(() => Math.min(this.dexterity(), this.wits()), this);\r\n        this.armor = ko.observable(json.armor).extend({ numeric: { precision: 0 } }).extend({ lockable: this.locked });\r\n        this.initiative = ko.computed(() => this.dexterity() + this.composure(), this);\r\n        this.experience = ko.observable(json.experience).extend({ numeric: { precision: 0 }, lockable: this.locked });\r\n        this.morality = ko.observable(json.morality).extend({ numeric: { precision: 0, min: 1, max: 10 }, lockable: this.locked });\r\n\r\n        this.weapons = ko.observableArray(json.weapons.map(w => new Equipment(w.name, w.description, this.locked)));\r\n        this.equipment = ko.observableArray(json.equipment.map(e => new Equipment(e.name, e.description, this.locked)));\r\n        this.inventory = ko.observableArray(json.inventory.map(i => new InventoryItem(i.name, i.description, i.quantity, this.locked)));\r\n\r\n        this.notes = ko.observableArray(json.notes.map(n => new Note(n, this.locked)));\r\n\r\n        this.health = ko.computed(() => this.stamina() + this.size(), this);\r\n        this.damage = new Damage(this.health, json.bashing, json.lethal, json.aggravated, this.locked);\r\n\r\n        this.magic = ko.computed(() => this.resolve() + this.composure(), this);\r\n        this.usedMagic = ko.observable(json.usedMagic || 0).extend({ lockable: this.locked });\r\n        this.magic.subscribe(val => {\r\n            if (this.usedMagic() > val) CommandStack.instance.executeWithPrevious(new AttributeCommand(this.usedMagic, val, this.usedMagic()));\r\n        }, this);\r\n\r\n        this.willpower = ko.computed(() => this.resolve() + this.composure(), this);\r\n        this.usedWillpower = ko.observable(json.usedWillpower || 0).extend({ lockable: this.locked });\r\n        this.willpower.subscribe(val => {\r\n            if (this.usedWillpower() > val) CommandStack.instance.executeWithPrevious(new AttributeCommand(this.usedWillpower, val, this.usedWillpower()));\r\n        }, this);\r\n    }\r\n\r\n    public static newCharacter(): Character {\r\n        return new Character({\r\n            name: randomName(),\r\n            player: \"\",\r\n            age: 0,\r\n            vice: \"\",\r\n            virtue: \"\",\r\n            origins: \"\",\r\n            gender: \"\",\r\n            concept: \"\",\r\n            chronicle: \"\",\r\n\r\n            intelligence: 1,\r\n            strength: 1,\r\n            presence: 1,\r\n            wits: 1,\r\n            dexterity: 1,\r\n            manipulation: 1,\r\n            resolve: 1,\r\n            stamina: 1,\r\n            composure: 1,\r\n\r\n            academics: 0,\r\n            robotics: 0,\r\n            crafts: 0,\r\n            investigation: 0,\r\n            medicine: 0,\r\n            occult: 0,\r\n            politics: 0,\r\n            science: 0,\r\n\r\n            athletics: 0,\r\n            brawl: 0,\r\n            drive: 0,\r\n            ranged: 0,\r\n            larceny: 0,\r\n            stealth: 0,\r\n            survival: 0,\r\n            weaponry: 0,\r\n\r\n            animalKen: 0,\r\n            empathy: 0,\r\n            expression: 0,\r\n            intimidation: 0,\r\n            persuasion: 0,\r\n            socialize: 0,\r\n            streetwise: 0,\r\n            subterfuge: 0,\r\n\r\n            merits: [],\r\n            spells: [],\r\n            flaws: [],\r\n\r\n            size: 5,\r\n            armor: 0,\r\n            experience: 0,\r\n            morality: 7,\r\n\r\n            weapons: [],\r\n            equipment: [],\r\n            inventory: [],\r\n\r\n            notes: []\r\n        });\r\n    }\r\n\r\n    public static fromJson(json: CharacterJson): Character {\r\n        return new Character(json);\r\n    }\r\n\r\n    public onComponentClick(_: any, e: Event): void {\r\n        const element = <HTMLElement>e.currentTarget;\r\n        element.getElementsByTagName(\"input\")[0].focus();\r\n    }\r\n\r\n    public newItem<T>(observableArray: KnockoutObservableArray<T>, constructor: { createLockable(locked: KnockoutObservable<boolean>): T}): () => void {\r\n        return () => {\r\n            if (this.locked()) return;\r\n            CommandStack.instance.execute(new CollectionAddCommand(observableArray, constructor.createLockable(this.locked)));\r\n        };\r\n    }\r\n\r\n    public removeItem<T>(observableArray: KnockoutObservableArray<T>): (item: T) => void {\r\n        return (item: T) => {\r\n            if (this.locked()) return;\r\n            CommandStack.instance.execute(new CollectionRemoveCommand(observableArray, item));\r\n        };\r\n    }\r\n\r\n    public moveItem<T>(observableArray: KnockoutObservableArray<T>, direction: number): (item: T) => void {\r\n        return (item: T) => {\r\n            if (this.locked()) return;\r\n            const index = observableArray.indexOf(item);\r\n            const newIndex = index + direction;\r\n\r\n            if (newIndex < 0 || newIndex >= observableArray().length) return;\r\n\r\n            CommandStack.instance.execute(new CollectionMoveCommand(observableArray, item, newIndex, index));\r\n        };\r\n    }\r\n\r\n    public clearUsed(usedObservable: KnockoutObservable<number>): () => void {\r\n        return () => {\r\n            CommandStack.instance.execute(new ClearUsedCommand(usedObservable));\r\n        };\r\n    }\r\n\r\n    public toJson(): CharacterJson {\r\n        return {\r\n            name: this.name(),\r\n            player: this.player(),\r\n            age: this.age(),\r\n            vice: this.vice(),\r\n            virtue: this.virtue(),\r\n            origins: this.origins(),\r\n            gender: this.gender(),\r\n            concept: this.concept(),\r\n            chronicle: this.chronicle(),\r\n\r\n            intelligence: this.intelligence(),\r\n            wits: this.wits(),\r\n            resolve: this.resolve(),\r\n            strength: this.strength(),\r\n            dexterity: this.dexterity(),\r\n            stamina: this.stamina(),\r\n            presence: this.presence(),\r\n            manipulation: this.manipulation(),\r\n            composure: this.composure(),\r\n\r\n            bashing: this.damage.bashing(),\r\n            lethal: this.damage.lethal(),\r\n            aggravated: this.damage.aggravated(),\r\n            usedMagic: this.usedMagic(),\r\n            usedWillpower: this.usedWillpower(),\r\n\r\n            academics: this.academics(),\r\n            robotics: this.robotics(),\r\n            crafts: this.crafts(),\r\n            investigation: this.investigation(),\r\n            medicine: this.medicine(),\r\n            occult: this.occult(),\r\n            politics: this.politics(),\r\n            science: this.science(),\r\n\r\n            athletics: this.athletics(),\r\n            brawl: this.brawl(),\r\n            drive: this.drive(),\r\n            ranged: this.ranged(),\r\n            larceny: this.larceny(),\r\n            stealth: this.stealth(),\r\n            survival: this.survival(),\r\n            weaponry: this.weaponry(),\r\n\r\n            animalKen: this.animalKen(),\r\n            empathy: this.empathy(),\r\n            expression: this.expression(),\r\n            intimidation: this.intimidation(),\r\n            persuasion: this.persuasion(),\r\n            socialize: this.socialize(),\r\n            streetwise: this.streetwise(),\r\n            subterfuge: this.subterfuge(),\r\n\r\n            merits: this.merits().map(m => { return { name: m.name(), value: m.value() }; }),\r\n            spells: this.spells().map(s => { return { name: s.name(), value: s.value() }; }),\r\n            flaws: this.flaws().map(f => { return { name: f.name(), value: f.value() }; }),\r\n\r\n            size: this.size(),\r\n            armor: this.armor(),\r\n            experience: this.experience(),\r\n            morality: this.morality(),\r\n\r\n            weapons: this.weapons().map(w => { return { name: w.name(), description: w.description() }; }),\r\n            equipment: this.equipment().map(e => { return { name: e.name(), description: e.description() }; }),\r\n            inventory: this.inventory().map(i => { return { name: i.name(), description: i.description(), quantity: i.quantity() }; }),\r\n\r\n            notes: this.notes().map(n => n.value())\r\n        };\r\n    }\r\n}\r\n\r\nconst alphabet = \"abcdefghijklmnopqrstuvwxyz\";\r\nfunction randomName() {\r\n    const firstNameLength = randomInteger(5, 12);\r\n    const lastNameLength = randomInteger(5, 12);\r\n    let firstName = \"\";\r\n    let lastName = \"\";\r\n\r\n    for (let i = 0; i < firstNameLength; i++) {\r\n        let newLetter = alphabet.charAt(randomInteger(0, alphabet.length));\r\n        if (i === 0) newLetter = newLetter.toUpperCase();\r\n\r\n        firstName += newLetter;\r\n    }\r\n\r\n    for (let i = 0; i < lastNameLength; i++) {\r\n        let newLetter = alphabet.charAt(randomInteger(0, alphabet.length));\r\n        if (i === 0) newLetter = newLetter.toUpperCase();\r\n\r\n        lastName += newLetter;\r\n    }\r\n\r\n    return `${firstName} ${lastName}`;\r\n}\r\n\r\nexport type CharacterJson = {\r\n    name: string,\r\n    player: string,\r\n    age: number,\r\n    vice: string,\r\n    virtue: string,\r\n    origins: string,\r\n    gender: string,\r\n    concept: string,\r\n    chronicle: string,\r\n\r\n    intelligence: number,\r\n    strength: number,\r\n    presence: number,\r\n    wits: number,\r\n    dexterity: number,\r\n    manipulation: number,\r\n    resolve: number,\r\n    stamina: number,\r\n    composure: number,\r\n\r\n    academics: number,\r\n    robotics: number,\r\n    crafts: number,\r\n    investigation: number,\r\n    medicine: number,\r\n    occult: number,\r\n    politics: number,\r\n    science: number,\r\n\r\n    athletics: number,\r\n    brawl: number,\r\n    drive: number,\r\n    ranged: number,\r\n    larceny: number,\r\n    stealth: number,\r\n    survival: number,\r\n    weaponry: number,\r\n\r\n    animalKen: number,\r\n    empathy: number,\r\n    expression: number,\r\n    intimidation: number,\r\n    persuasion: number,\r\n    socialize: number,\r\n    streetwise: number,\r\n    subterfuge: number,\r\n\r\n    merits: Array<{ name: string, value: number }>,\r\n    spells: Array<{ name: string, value: number }>,\r\n    flaws: Array<{ name: string, value: number }>,\r\n\r\n    size: number,\r\n    armor: number,\r\n    experience: number,\r\n    morality: number,\r\n\r\n    weapons: Array<{ name: string, description: string }>,\r\n    equipment: Array<{ name: string, description: string }>,\r\n    inventory: Array<{ name: string, description: string, quantity: number }>,\r\n\r\n    notes: Array<string>,\r\n\r\n    bashing?: number,\r\n    lethal?: number,\r\n    aggravated?: number,\r\n\r\n    usedMagic?: number,\r\n    usedWillpower?: number\r\n};","import CommandStack from \"../Command/CommandStack\";\r\nimport AttributeCommand from \"../Command/AttributeCommand\";\r\nimport BatchCommand from \"../Command/BatchCommand\";\r\n\r\nexport default class Damage {\r\n    public totalHealth: KnockoutComputed<number>;\r\n    public bashing: KnockoutObservable<number>;\r\n    public lethal: KnockoutObservable<number>;\r\n    public aggravated: KnockoutObservable<number>;\r\n\r\n    public constructor(totalHealthObservable: KnockoutComputed<number>, bashing?: number, lethal?: number, aggravated?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.totalHealth = totalHealthObservable;\r\n        this.bashing = ko.observable(bashing || 0);\r\n        this.lethal = ko.observable(lethal || 0);\r\n        this.aggravated = ko.observable(aggravated || 0);\r\n\r\n        if (locked) {\r\n            this.bashing = this.bashing.extend({ lockable: locked });\r\n            this.lethal = this.lethal.extend({ lockable: locked });\r\n            this.aggravated = this.aggravated.extend({ lockable: locked });\r\n        }\r\n\r\n        totalHealthObservable.subscribe(val => {\r\n            let bashing = this.bashing();\r\n            let lethal = this.lethal();\r\n            let aggravated = this.aggravated();\r\n            while (bashing + lethal + aggravated > val) {\r\n                if (bashing > 0) {\r\n                    bashing--;\r\n                }\r\n                else if (lethal > 0) {\r\n                    lethal--;\r\n                }\r\n                else {\r\n                    aggravated--;\r\n                }\r\n            }\r\n            CommandStack.instance.executeWithPrevious(new BatchCommand(\r\n                new AttributeCommand(this.bashing, bashing, this.bashing()),\r\n                new AttributeCommand(this.lethal, lethal, this.lethal()),\r\n                new AttributeCommand(this.aggravated, aggravated, this.aggravated())\r\n            ));\r\n        }, this);\r\n    }\r\n\r\n    public anyEmpty(): boolean {\r\n        return this.bashing() + this.lethal() + this.aggravated() < this.totalHealth();\r\n    }\r\n\r\n    public addBashing(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.bashing, this.bashing() + 1, this.bashing()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public addLethal(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.lethal, this.lethal() + 1, this.lethal())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public addAggravated(): void {\r\n        if (this.anyEmpty()) {\r\n            CommandStack.instance.execute(new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated()));\r\n        }\r\n        else if (this.bashing() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.bashing, this.bashing() - 1, this.bashing()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else if (this.lethal() > 0) {\r\n            CommandStack.instance.execute(new BatchCommand(\r\n                new AttributeCommand(this.lethal, this.lethal() - 1, this.lethal()),\r\n                new AttributeCommand(this.aggravated, this.aggravated() + 1, this.aggravated())\r\n            ));\r\n        }\r\n        else {\r\n            alert(\"you ded\");\r\n        }\r\n    }\r\n\r\n    public clearAll(): void {\r\n        CommandStack.instance.execute(new BatchCommand(\r\n            new AttributeCommand(this.bashing, 0, this.bashing()),\r\n            new AttributeCommand(this.lethal, 0, this.lethal()),\r\n            new AttributeCommand(this.aggravated, 0, this.aggravated())\r\n        ));\r\n    }\r\n}","export default class Equipment {\r\n    public name: KnockoutObservable<string>;\r\n    public description: KnockoutObservable<string>;\r\n\r\n    public constructor(name?: string, description?: string, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.description = ko.observable(description || \"\");\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.description = this.description.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Equipment(null, null, locked);\r\n    }\r\n}","export default class InventoryItem {\r\n    public name: KnockoutObservable<string>;\r\n    public description: KnockoutObservable<string>;\r\n    public quantity: KnockoutObservable<number>;\r\n    public displayText: KnockoutComputed<string>;\r\n\r\n    public constructor(name?: string, description?: string, quantity?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.description = ko.observable(description || \"\");\r\n        this.quantity = ko.observable(quantity || 1);\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.description = this.description.extend({ lockable: locked });\r\n            this.quantity = this.quantity.extend({ lockable: locked });\r\n        }\r\n\r\n        this.displayText = ko.computed(this.getDisplayText, this);\r\n    }\r\n\r\n    public getDisplayText() : string {\r\n        return `${this.quantity()} ${this.name()}`;\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new InventoryItem(null, null, null, locked);\r\n    }\r\n}","export default class Merit {\r\n    public name: KnockoutObservable<string>;\r\n    public value: KnockoutObservable<number>;\r\n\r\n    public constructor(name?: string, value?: number, locked?: KnockoutObservable<boolean>) {\r\n        this.name = ko.observable(name || \"\");\r\n        this.value = ko.observable(value || 0);\r\n\r\n        if (locked) {\r\n            this.name = this.name.extend({ lockable: locked });\r\n            this.value = this.value.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Merit(null, null, locked);\r\n    }\r\n}","export default class Note {\r\n    public value: KnockoutObservable<string>;\r\n\r\n    public constructor(value?: string, locked?: KnockoutObservable<boolean>) {\r\n        this.value = ko.observable(value || \"\");\r\n\r\n        if (locked) {\r\n            this.value = this.value.extend({ lockable: locked });\r\n        }\r\n    }\r\n\r\n    public static createLockable(locked: KnockoutObservable<boolean>) {\r\n        return new Note(null, locked);\r\n    }\r\n}","import ICharacterRepository from \"./ICharacterRepository\";\r\nimport Character, { CharacterJson } from \"../Character\";\r\n\r\n$.cookie.json = true;\r\nconst characterCookiePrefix = \"_character-\";\r\nconst characterListCookieKey = \"_characters\";\r\nexport default class CookieCharacterRepository implements ICharacterRepository {\r\n    private _characterIds: number[];\r\n\r\n    public constructor() {\r\n        this._characterIds = [];\r\n    }\r\n\r\n    public loadCharacters(): Character[] {\r\n        const characters: CharacterJson[] = [];\r\n\r\n        this._characterIds = $.cookie(characterListCookieKey);\r\n        if (!this._characterIds) this._characterIds = [];\r\n\r\n        for (let characterId of this._characterIds) {\r\n            const key = `${characterCookiePrefix}${characterId}`;\r\n            characters.push($.cookie(key));\r\n        }\r\n\r\n        return characters.map(Character.fromJson);\r\n    }\r\n\r\n    public saveCharacters(characters: Character[]): boolean {\r\n        for (let oldId of this._characterIds) {\r\n            $.removeCookie(`${characterCookiePrefix}${oldId}`);\r\n        }\r\n        this._characterIds = [];\r\n\r\n        for (let i = 0; i < characters.length; i++) {\r\n            this._characterIds.push(i);\r\n            $.cookie(`${characterCookiePrefix}${i}`, characters[i].toJson());\r\n        }\r\n\r\n        $.cookie(characterListCookieKey, this._characterIds);\r\n\r\n        return true;\r\n    }\r\n}","import ICharacterRepository from \"./ICharacterRepository\";\r\nimport Character from \"../Character\";\r\n\r\n// This does nothing. It shouldn't actually be used when the project is finished.\r\nexport default class DummyCharacterRepository implements ICharacterRepository {\r\n    public loadCharacters(): Character[] { return []; }\r\n    public saveCharacters(characters: Character[]): boolean { return true; }\r\n}","import Character from \"../Character\";\r\nimport LocalStorageCharacterRepository from \"./LocalStorageCharacterRepository\";\r\nimport DummyCharacterRepository from \"./DummyCharacterRepository\";\r\nimport CookieCharacterRepository from \"./CookieCharacterRepository\";\r\n\r\nexport default interface ICharacterRepository {\r\n    loadCharacters(): Character[];\r\n    saveCharacters(characters: Character[]): boolean;\r\n}\r\n\r\nexport function getCharacterRepository(type: string, ...args: any[]): ICharacterRepository {\r\n    switch (type) {\r\n        case \"Dummy\": return new DummyCharacterRepository();\r\n        case \"LocalStorage\":\r\n            if (LocalStorageCharacterRepository.IsSupported) return new LocalStorageCharacterRepository();\r\n            else {\r\n                swal({\r\n                    title: `Local Storage Not Supported`,\r\n                    text: \"Your browser does not support local storage. This just means we have to use cookies to save your characters, which are not as safe as far as maintaining them. You should make sure to use the download button for each character before ending your session to ensure you have them backed up.\",\r\n                    icon: \"warning\",\r\n                    button: \"OK\",\r\n                    dangerMode: true\r\n                });\r\n            }\r\n            break;\r\n        // TODO: Maybe add a swal warning here.\r\n        case \"Cookie\": return new CookieCharacterRepository();\r\n    }\r\n\r\n    return new CookieCharacterRepository();\r\n}","import ICharacterRepository from \"./ICharacterRepository\";\r\nimport Character from \"../Character\";\r\n\r\nconst storageKey = \"characters\";\r\nexport default class LocalStorageCharacterRepository implements ICharacterRepository {\r\n    public loadCharacters(): Character[] {\r\n        return (JSON.parse(window.localStorage.getItem(storageKey)) || []).map(Character.fromJson);\r\n    }\r\n\r\n    public saveCharacters(characters: Character[]): boolean {\r\n        window.localStorage.setItem(\"characters\", JSON.stringify(characters.map(c => c.toJson())));\r\n        return true;\r\n    }\r\n\r\n    public static get IsSupported(): boolean {\r\n        const test = \"test\";\r\n        try {\r\n            window.localStorage.setItem(test, test);\r\n            window.localStorage.removeItem(test);\r\n            return true;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class AttributeCommand implements ICommand {\r\n    private _observable: KnockoutObservable<number>;\r\n    private _newValue: number;\r\n    private _oldValue: number;\r\n\r\n    public constructor(observable: KnockoutObservable<number>, newValue: number, oldValue: number) {\r\n        this._observable = observable;\r\n        this._newValue = newValue;\r\n        this._oldValue = oldValue;\r\n    }\r\n\r\n    public getType(): string { return \"AttributeCommand\"; }\r\n    public toString(): string {\r\n        return `${this._observable.getName()}: ${this._oldValue} => ${this._newValue}`;\r\n    }\r\n\r\n    public execute(): void {\r\n        this._observable(this._newValue);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newValue === this._oldValue;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class BatchCommand implements ICommand {\r\n    private _commands: ICommand[];\r\n\r\n    public constructor(...commands: ICommand[]) {\r\n        this._commands = commands.filter(command => !command.doesNothing());\r\n    }\r\n\r\n    public get commandCount(): number { return this._commands.length; }\r\n\r\n    public getType(): string { return \"BatchCommand\"; }\r\n\r\n    public getCommand(index: number): ICommand | null {\r\n        if (index < 0 || index >= this._commands.length) return null;\r\n\r\n        return this._commands[index];\r\n    }\r\n\r\n    public execute(): void {\r\n        for (let i = 0; i < this._commands.length; i++) this._commands[i].execute();\r\n    }\r\n\r\n    public undo(): void {\r\n        for (let i = this._commands.length - 1; i >= 0; i--) this._commands[i].undo();\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._commands.every(command => command.doesNothing());\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class ClearUsedCommand implements ICommand {\r\n    private _observable: KnockoutObservable<number>;\r\n    private _oldValue: number;\r\n\r\n    public constructor(observable: KnockoutObservable<number>) {\r\n        this._observable = observable;\r\n        this._oldValue = observable();\r\n    }\r\n\r\n    public getType(): string { return \"ClearUsedCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable(0);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._oldValue === 0;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionAddCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _newItem: T;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, newItem: T) {\r\n        this._observable = observable;\r\n        this._newItem = newItem;\r\n    }\r\n\r\n    public getType(): string { return \"CollectionAddCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.push(this._newItem);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.remove(this._newItem);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return false;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionMoveCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _item: T;\r\n    private _newIndex: number;\r\n    private _oldIndex: number;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, item: T, newIndex: number, oldIndex: number) {\r\n        this._observable = observable;\r\n        this._item = item;\r\n        this._newIndex = newIndex;\r\n        this._oldIndex = oldIndex;\r\n    }\r\n\r\n    public getType(): string { return \"CollectionMoveCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.splice(this._oldIndex, 1);\r\n        this._observable.splice(this._newIndex, 0, this._item);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.splice(this._newIndex, 1);\r\n        this._observable.splice(this._oldIndex, 0, this._item);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newIndex === this._oldIndex;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class CollectionRemoveCommand<T> implements ICommand {\r\n    private _observable: KnockoutObservableArray<T>;\r\n    private _item: T;\r\n    private _itemIndex: number;\r\n\r\n    public constructor(observable: KnockoutObservableArray<T>, item: T) {\r\n        this._observable = observable;\r\n        this._item = item;\r\n        this._itemIndex = this._observable.indexOf(this._item);\r\n    }\r\n\r\n    public getType(): string { return \"CollectionRemoveCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable.remove(this._item);\r\n    }\r\n\r\n    public undo(): void {\r\n        this._observable.splice(this._itemIndex, 0, this._item);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return false;\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\nimport BatchCommand from \"./BatchCommand\";\r\n\r\nexport default class CommandStack {\r\n    private static _instance: CommandStack;\r\n    \r\n    private _undoStack: KnockoutObservableArray<ICommand>;\r\n    private _redoStack: KnockoutObservableArray<ICommand>;\r\n    private _currentlyExecuting: boolean;\r\n\r\n    public canUndo: KnockoutComputed<boolean>;\r\n    public canRedo: KnockoutComputed<boolean>;\r\n\r\n    private constructor() {\r\n        this._undoStack = ko.observableArray([]);\r\n        this._redoStack = ko.observableArray([]);\r\n        this._currentlyExecuting = false;\r\n\r\n        this.canUndo = ko.computed(() => this.undoLength > 0, this);\r\n        this.canRedo = ko.computed(() => this.redoLength > 0, this);\r\n    }\r\n\r\n    public static get instance(): CommandStack {\r\n        if (!CommandStack._instance) CommandStack._instance = new CommandStack();\r\n\r\n        return CommandStack._instance;\r\n    }\r\n\r\n    public get undoLength(): number { return this._undoStack().length; }\r\n    public get redoLength(): number { return this._redoStack().length; }\r\n\r\n    public getPreviousCommand(drillIntoBatch: boolean = false): ICommand {\r\n        let previousCommand = this._undoStack()[this.undoLength - 1];\r\n\r\n        if (!drillIntoBatch) return previousCommand;\r\n\r\n        while (previousCommand instanceof BatchCommand) {\r\n            previousCommand = previousCommand.getCommand(previousCommand.commandCount - 1);\r\n        }\r\n\r\n        return previousCommand;\r\n    }\r\n\r\n    // TODO: Maybe don't have this as singleton...\r\n    // Could have an instance for each character\r\n    // to preserve the stack across character selection\r\n    public reset(): void {\r\n        this._undoStack.removeAll();\r\n        this._redoStack.removeAll();\r\n    }\r\n\r\n    public execute(command: ICommand): void {\r\n        if (command.doesNothing()) return;\r\n\r\n        if (this._currentlyExecuting) {\r\n            window.setTimeout(() => this.execute(command), 1);\r\n            return;\r\n        }\r\n\r\n        this._currentlyExecuting = true;\r\n        command.execute();\r\n        this._undoStack.push(command);\r\n        this._redoStack.removeAll();\r\n        this._currentlyExecuting = false;\r\n    }\r\n\r\n    public executeWithPrevious(command: ICommand): void {\r\n        if (command.doesNothing()) return;\r\n\r\n        if (this._currentlyExecuting) {\r\n            window.setTimeout(() => this.executeWithPrevious(command), 1);\r\n            return;\r\n        }\r\n\r\n        this._currentlyExecuting = true;\r\n        command.execute();\r\n        let previousCommand = this._undoStack.pop();\r\n        this._undoStack.push(new BatchCommand(previousCommand, command));\r\n        this._redoStack.removeAll();\r\n        this._currentlyExecuting = false;\r\n    }\r\n\r\n    public undo(): void {\r\n        if (this._undoStack().length === 0) return;\r\n        \r\n        const command = this._undoStack.pop();\r\n\r\n        command.undo();\r\n        this._redoStack.push(command);\r\n    }\r\n\r\n    public redo(): void {\r\n        if (this._redoStack().length === 0) return;\r\n\r\n        const command = this._redoStack.pop();\r\n        command.execute();\r\n        this._undoStack.push(command);\r\n    }\r\n\r\n    public log(): void {\r\n        console.log(\"UNDO STACK:\");\r\n        console.log(this._undoStack());\r\n        console.log(\"REDO STACK:\");\r\n        console.log(this._redoStack());\r\n    }\r\n}","import ICommand from \"./ICommand\";\r\n\r\nexport default class TextInputCommand implements ICommand {\r\n    private _observable: KnockoutObservable<string>;\r\n    private _newValue: string;\r\n    private _oldValue: string;\r\n\r\n    public constructor(observable: KnockoutObservable<string>, newValue: string, oldValue: string) {\r\n        this._observable = observable;\r\n        this._newValue = newValue;\r\n        this._oldValue = oldValue;\r\n    }\r\n\r\n    public getType(): string { return \"TextInputCommand\"; }\r\n\r\n    public execute(): void {\r\n        this._observable(this._newValue);\r\n    }\r\n\r\n    public undo(): void  {\r\n        this._observable(this._oldValue);\r\n    }\r\n\r\n    public doesNothing(): boolean {\r\n        return this._newValue === this._oldValue;\r\n    }\r\n}","import { randomFloat, randomInteger } from \"./utils\";\r\n\r\nexport default class Dice {\r\n    public dicePool: KnockoutObservable<number>;\r\n    public rollRounds: KnockoutObservableArray<Array<number>>;\r\n    public rollingInProgress: KnockoutObservable<boolean>;\r\n    public totalDiceSuccesses: KnockoutComputed<number>;\r\n    public totalDiceSuccessesDisplay: KnockoutComputed<string>;\r\n\r\n    public constructor() {\r\n        this.dicePool = ko.observable(1);\r\n        this.rollRounds = ko.observableArray([]);\r\n        this.rollingInProgress = ko.observable(false);\r\n        this.totalDiceSuccesses = ko.computed(() => {\r\n            if (this.rollingInProgress() || this.rollRounds().length === 0) return -1;\r\n\r\n            return this.rollRounds().reduce((total: number, r: Array<number>) => {\r\n                return total + r.reduce((total: number, d: number) => total + (d > 7 ? 1 : 0), 0);\r\n            }, 0);\r\n        }, this);\r\n        this.totalDiceSuccessesDisplay = ko.computed(() => {\r\n            return this.totalDiceSuccesses() >= 0 ? \"\" + this.totalDiceSuccesses() : \"???\";\r\n        }, this);\r\n    }\r\n\r\n    public incrementDicePool(amount: number): () => void {\r\n        return () => {\r\n            let newAmount = this.dicePool() + amount;\r\n            if (newAmount < 1) newAmount = 1;\r\n            this.dicePool(newAmount);\r\n        };\r\n    }\r\n\r\n    public rollDice(): void {\r\n        const roller = new RollState(this);\r\n        roller.beginRoll();\r\n    }\r\n}\r\n\r\nclass RollState {\r\n    private _diceObj: Dice;\r\n    private _currentRound: number;\r\n    private _currentDice: number;\r\n    private _currentRoundRolls: number;\r\n    private _currentRoundResults: Array<number>;\r\n    private _nextRoundRolls: number;\r\n    private _intervalHandle: number;\r\n\r\n    public constructor(diceObj: Dice) {\r\n        this._diceObj = diceObj;\r\n        this._currentRound = 0;\r\n        this._currentDice = 0;\r\n        this._currentRoundRolls = diceObj.dicePool();\r\n        this._currentRoundResults = [];\r\n        this._nextRoundRolls = 0;\r\n        this._intervalHandle = null;\r\n    }\r\n\r\n    public beginRoll(): void {\r\n        this._diceObj.rollingInProgress(true);\r\n        this._diceObj.rollRounds.removeAll();\r\n        for (let i = 0; i < this._currentRoundRolls; i++) this._currentRoundResults.push(-1);\r\n        this._diceObj.rollRounds.push(this._currentRoundResults);\r\n\r\n        this._intervalHandle = window.setInterval(() => {\r\n            const nextRoll = randomInteger(1, 11);\r\n            if (nextRoll === 10) {\r\n                this._nextRoundRolls++;\r\n                const diceContainer = document.getElementsByClassName(\"diceContainer\")[0];\r\n                const critMessage = document.createElement(\"div\");\r\n                critMessage.classList.add(\"crit-message\");\r\n                critMessage.innerText = \"Crit!\";\r\n                critMessage.id = \"critMessage\";\r\n                diceContainer.appendChild(critMessage);\r\n                window.setTimeout(() => diceContainer.removeChild(critMessage), 1010);\r\n            }\r\n            this._currentRoundResults[this._currentDice] = nextRoll;\r\n            this._diceObj.rollRounds.replace(this._diceObj.rollRounds()[this._currentRound], this._currentRoundResults);\r\n            this._currentDice++;\r\n\r\n            if (this._currentDice === this._currentRoundRolls) {\r\n                if (this._nextRoundRolls === 0) {\r\n                    window.clearInterval(this._intervalHandle);\r\n                    this._diceObj.rollingInProgress(false);\r\n                    const critMessage = document.getElementById(\"critMessage\");\r\n                    if (critMessage) {\r\n                        critMessage.remove();\r\n                    }\r\n                    return;\r\n                }\r\n                else {\r\n                    this._currentRound++;\r\n                    this._currentRoundRolls = this._nextRoundRolls;\r\n                    this._nextRoundRolls = 0;\r\n                    this._currentDice = 0;\r\n                    this._currentRoundResults = [];\r\n                    for (let i = 0; i < this._currentRoundRolls; i++) this._currentRoundResults.push(-1);\r\n                    this._diceObj.rollRounds.push(this._currentRoundResults);\r\n                }\r\n            }\r\n        }, 100);\r\n    }\r\n}","const _keyboardCommands = new Map<string, () => void>();\r\nexport function registerKeyboardCommand(key: string, callback: () => void): void {\r\n    _keyboardCommands.set(key, callback);\r\n}\r\n\r\nwindow.addEventListener(\"keydown\", e => {\r\n    if (e.ctrlKey !== true) return;\r\n\r\n    for (let [key, callback] of _keyboardCommands.entries()) {\r\n        if (e.key === key) {\r\n            e.preventDefault();\r\n            callback();\r\n            return;\r\n        }\r\n    }\r\n});","import Application from \"./Application\";\r\nimport Equipment from \"./Character/Equipment\";\r\nimport InventoryItem from \"./Character/InventoryItem\";\r\nimport Merit from \"./Character/Merit\";\r\nimport Note from \"./Character/Note\";\r\nimport { applyCustomKnockoutCode } from \"./utils\";\r\n\r\napplyCustomKnockoutCode();\r\n\r\nconst constructors = {\r\n    Equipment: Equipment,\r\n    InventoryItem: InventoryItem,\r\n    Merit: Merit,\r\n    Note: Note\r\n};\r\nObject.defineProperty(window, \"constructors\", { value: constructors });\r\n\r\nconst app = new Application();\r\nko.applyBindings(app);\r\n\r\n// Exposing the view model to the global state in case manual changes need to be applied\r\nObject.defineProperty(window, \"app\", { value: app });\r\n\r\nfunction toggleTooltips(enable: boolean): void {\r\n    if (enable) $(\"[data-toggle='tooltip']\").tooltip();\r\n    else $(\"[data-toggle='tooltip']\").tooltip(\"dispose\");\r\n}\r\n\r\nwindow.addEventListener(\"resize\", () => {\r\n    toggleTooltips(window.outerWidth >= 992);\r\n});\r\ntoggleTooltips(window.outerWidth >= 992);","import Damage from \"./Character/Damage\";\r\nimport CommandStack from \"./Command/CommandStack\";\r\nimport AttributeCommand from \"./Command/AttributeCommand\";\r\nimport TextInputCommand from \"./Command/TextInputCommand\";\r\n\r\nexport function randomInteger(minInclusive = 0, maxExclusive = 10): number {\r\n    if (maxExclusive < minInclusive) {\r\n        [minInclusive, maxExclusive] = [maxExclusive, minInclusive];\r\n    }\r\n\r\n    return Math.floor(Math.random() * (maxExclusive - minInclusive)) + minInclusive;\r\n}\r\n\r\nexport function randomFloat(minInclusive = 0, maxExclusive = 1): number {\r\n    if (maxExclusive < minInclusive) {\r\n        [minInclusive, maxExclusive] = [maxExclusive, minInclusive];\r\n    }\r\n\r\n    return Math.random() * (maxExclusive - minInclusive) + minInclusive;\r\n}\r\n\r\nconst _observableNameMap = new Map<KnockoutObservable<any>, string>();\r\nexport function applyCustomKnockoutCode() {\r\n    applyKnockoutBindings();\r\n    applyKnockoutExtenders();\r\n    applyKnockoutCustomFunctions();\r\n}\r\n\r\nfunction applyKnockoutBindings() {\r\n    ko.bindingHandlers.dice = {\r\n        update: (element: HTMLElement, valueAccessor: () => KnockoutObservableArray<Array<number>>) => {\r\n            const rollRounds = valueAccessor()();\r\n            if (rollRounds.length === 0) {\r\n                element.innerHTML = \"\";\r\n                return;\r\n            }\r\n    \r\n            let divs = element.getElementsByClassName(\"dice-round\");\r\n            if (divs.length !== rollRounds.length) {\r\n                const newRound = document.createElement(\"div\");\r\n                newRound.classList.add(\"dice-round\");\r\n                const rolls = rollRounds[rollRounds.length - 1];\r\n                for (let i = 0; i < rolls.length; i++) {\r\n                    const span = document.createElement(\"span\");\r\n                    const delay = randomFloat(0, 0.5);\r\n                    span.style.animation = `rollingDice 0.5s linear -${delay}s infinite alternate`;\r\n                    span.classList.add(\"dice\");\r\n                    newRound.appendChild(span);\r\n                }\r\n                element.appendChild(newRound);\r\n                divs = element.getElementsByClassName(\"dice-round\");\r\n            }\r\n    \r\n            for (let i = 0; i < rollRounds.length; i++) {\r\n                const rolls = rollRounds[i];\r\n                const spans = divs[i].getElementsByClassName(\"dice\");\r\n                for (let j = 0; j < rolls.length; j++) {\r\n                    const roll = rolls[j];\r\n                    const span = <HTMLSpanElement>spans[j];\r\n    \r\n                    if (roll !== -1) {\r\n                        span.style.animation = null;\r\n                        span.style.backgroundImage = `url('images/dice-${roll}.png')`;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.damageDisplay = {\r\n        init: (element: HTMLElement) => {\r\n            for (let i = 0; i < 15; i++) {\r\n                const span = document.createElement(\"span\");\r\n                span.classList.add(\"damage\");\r\n                span.classList.add(\"none\");\r\n                element.appendChild(span);\r\n            }\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => Damage) => {\r\n            const damageObj = valueAccessor();\r\n            const spans = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < spans.length; i++) {\r\n                if (i < damageObj.aggravated()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.add(\"aggravated\");\r\n                }\r\n                else if (i - damageObj.aggravated() < damageObj.lethal()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"lethal\");\r\n                }\r\n                else if (i - damageObj.aggravated() - damageObj.lethal() < damageObj.bashing()) {\r\n                    spans[i].classList.remove(\"none\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"bashing\");\r\n                }\r\n                else {\r\n                    spans[i].classList.remove(\"bashing\");\r\n                    spans[i].classList.remove(\"lethal\");\r\n                    spans[i].classList.remove(\"aggravated\");\r\n                    spans[i].classList.add(\"none\");\r\n                }\r\n    \r\n                if (i < damageObj.totalHealth()) {\r\n                    spans[i].classList.remove(\"HIDDEN\");\r\n                }\r\n                else {\r\n                    spans[i].classList.add(\"HIDDEN\");\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.attribute = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number, canClear?: boolean }) => {\r\n            const dots: Array<HTMLSpanElement> = [];\r\n            for (let i = 0; i < valueAccessor().max; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                dot.classList.add(\"pointer\");\r\n                dot.dataset.toggle = \"tooltip\";\r\n                dot.title = \"\" + (i + 1);\r\n                $(dot).tooltip();\r\n    \r\n                dots.push(dot);\r\n    \r\n                dot.addEventListener(\"pointerenter\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                        if (index <= i) dot.classList.add(\"hoverFilled\");\r\n                    });\r\n                });\r\n                dot.addEventListener(\"pointerleave\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement) => {\r\n                        dot.classList.remove(\"hoverFilled\");\r\n                    });\r\n                });\r\n            }\r\n    \r\n            const canClear = valueAccessor().canClear;\r\n            if (canClear === true || typeof canClear === \"undefined\") {\r\n                const clearDot = document.createElement(\"div\");\r\n                clearDot.classList.add(\"clear-dot\");\r\n                clearDot.innerHTML = \"&times;\";\r\n                clearDot.dataset.toggle = \"tooltip\";\r\n                clearDot.title = \"Clear\";\r\n                clearDot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, 0, valueAccessor().value()));\r\n                });\r\n                element.appendChild(clearDot);\r\n                $(clearDot).tooltip();\r\n            }\r\n    \r\n            dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                element.appendChild(dot);\r\n                dot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, index + 1, valueAccessor().value()));\r\n                });\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number }) => {\r\n            const value = valueAccessor().value();\r\n            const dots = element.getElementsByClassName(\"attribute-dot\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                const dot = <HTMLSpanElement>dots[i];\r\n                dot.style.backgroundColor = null;\r\n                dot.style.borderColor = null;\r\n                if (i < value) {\r\n                    dot.style.backgroundColor = \"var(--body-color)\";\r\n                    dot.style.borderColor = \"var(--body-color)\";\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.readOnlyAttribute = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number }) => {\r\n            for (let i = 0; i < valueAccessor().max; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                element.appendChild(dot);\r\n            }\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, max: number, hideUnfilled?: boolean }) => {\r\n            const value = valueAccessor().value();\r\n            const dots = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                dots[i].classList.remove(\"filled\");\r\n                if (i < value) {\r\n                    dots[i].classList.add(\"filled\");\r\n                    dots[i].classList.remove(\"HIDDEN\");\r\n                }\r\n                else if (valueAccessor().hideUnfilled) {\r\n                    dots[i].classList.add(\"HIDDEN\");\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.used = {\r\n        init: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, total: KnockoutComputed<number> }) => {\r\n            const dots: Array<HTMLSpanElement> = [];\r\n            for (let i = 0; i < 12; i++) {\r\n                const dot = document.createElement(\"span\");\r\n                dot.classList.add(\"attribute-dot\");\r\n                element.appendChild(dot);\r\n    \r\n                dots.push(dot);\r\n    \r\n                dot.addEventListener(\"pointerenter\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                        if (index <= i) dot.classList.add(\"hoverFilled\");\r\n                    });\r\n                });\r\n                dot.addEventListener(\"pointerleave\", () => {\r\n                    dots.forEach((dot: HTMLSpanElement) => {\r\n                        dot.classList.remove(\"hoverFilled\");\r\n                    });\r\n                });\r\n            }\r\n            dots.forEach((dot: HTMLSpanElement, index: number) => {\r\n                dot.addEventListener(\"click\", () => {\r\n                    CommandStack.instance.execute(new AttributeCommand(valueAccessor().value, index + 1, valueAccessor().value()));\r\n                });\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => { value: KnockoutObservable<number>, total: KnockoutComputed<number> }) => {\r\n            const used = valueAccessor().value();\r\n            const total = valueAccessor().total();\r\n            const dots = element.getElementsByTagName(\"span\");\r\n            for (let i = 0; i < dots.length; i++) {\r\n                if (i < used) dots[i].classList.add(\"filled-red\");\r\n                else dots[i].classList.remove(\"filled-red\");\r\n    \r\n                if (i < total) dots[i].classList.remove(\"HIDDEN\");\r\n                else dots[i].classList.add(\"HIDDEN\");\r\n            }\r\n        }\r\n    };\r\n    \r\n    ko.bindingHandlers.focusOnCreation = {\r\n        init: (element: HTMLInputElement | HTMLTextAreaElement) => {\r\n            window.setTimeout(() => {\r\n                if (element.value) return;\r\n                element.focus();\r\n            }, 1);\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.contextMenu = {\r\n        init: (element: HTMLElement, valueAccessor: () => () => void) => {\r\n            element.addEventListener(\"contextmenu\", e => {\r\n                e.preventDefault();\r\n                valueAccessor()();\r\n            });\r\n        }\r\n    };\r\n\r\n    ko.bindingHandlers.undoableTextInput = {\r\n        init: (element: HTMLElement, valueAccessor: () => KnockoutObservable<string>) => {\r\n            const inputElement = <HTMLInputElement>element;\r\n            inputElement.addEventListener(\"change\", () => {\r\n                const oldValue = valueAccessor()();\r\n                const newValue = inputElement.value;\r\n                if (oldValue === newValue) return;\r\n\r\n                valueAccessor()(newValue);\r\n                if (valueAccessor()() === oldValue) return;\r\n                valueAccessor()(oldValue);\r\n\r\n                CommandStack.instance.execute(new TextInputCommand(valueAccessor(), newValue, oldValue));\r\n            });\r\n        },\r\n        update: (element: HTMLElement, valueAccessor: () => KnockoutObservable<string>) => {\r\n            (<HTMLInputElement>element).value = valueAccessor()();\r\n        }\r\n    };\r\n}\r\nfunction applyKnockoutExtenders() {\r\n    ko.extenders.named = <T>(target: KnockoutObservable<T>, name: string) => {\r\n        // TODO: This requires that the `named` extension be the last one listed.\r\n        // It's messy and also inefficient because there will be multiple instances\r\n        // of the same observable property on a character equal to the number of\r\n        // characters the user has. I will need to come up with a different way,\r\n        // but for now this works as a proof of concept.\r\n        _observableNameMap.set(target, name);\r\n        return target;\r\n    };\r\n\r\n    ko.extenders.lockable = <T>(target: KnockoutObservable<T>, locked: KnockoutObservable<boolean>) => {\r\n        const result = ko.pureComputed({\r\n            read: target,\r\n            write: (newValue: T) => {\r\n                if (locked()) {\r\n                    target.notifySubscribers(target());\r\n                }\r\n                else {\r\n                    target(newValue);\r\n                    target.notifySubscribers(newValue);\r\n                }\r\n            }\r\n        }).extend({ notify: \"always\" });\r\n    \r\n        return result;\r\n    };\r\n    \r\n    ko.extenders.numeric = (target: KnockoutObservable<number>, args: { precision?: number, min?: number, max?: number }) => {\r\n        const precision = args.precision || 0;\r\n        const min = args.min || -Infinity;\r\n        const max = args.max || Infinity;\r\n    \r\n        // Create a writeable computed observable to intercept writes to our observable\r\n        const result = ko.pureComputed({\r\n            read: target, // Always return the original observable's value\r\n            write: (newValue: number) => {\r\n                const current = target();\r\n                const roundingMultiplier = Math.pow(10, precision);\r\n                const newValueAsNum = isNaN(newValue) ? 0 : +newValue;\r\n                let valueToWrite = Math.round(newValueAsNum * roundingMultiplier) / roundingMultiplier;\r\n                if (valueToWrite < min) valueToWrite = min;\r\n                else if (valueToWrite > max) valueToWrite = max;\r\n    \r\n                // Only write if it changed\r\n                if (valueToWrite !== current) {\r\n                    target(valueToWrite);\r\n                }\r\n                else {\r\n                    // If the rounded value is the same, but a different value was written,\r\n                    // force a notification for the current field\r\n                    if (newValue !== current) {\r\n                        target.notifySubscribers(valueToWrite);\r\n                    }\r\n                }\r\n            }\r\n        }).extend({ notify: \"always\" });\r\n    \r\n        // Initialize with current value to make sure it is rounded appropriately\r\n        result(target());\r\n    \r\n        // Return the new computed observable\r\n        return result;\r\n    };\r\n}\r\nfunction applyKnockoutCustomFunctions() {\r\n    ko.subscribable.fn.getName = function () {\r\n        return _observableNameMap.get(this);\r\n    };\r\n}"]}